(function(){"use strict";var na=Object.defineProperty,ra=(t,e,n)=>e in t?na(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,B=(t,e,n)=>(ra(t,typeof e!="symbol"?e+"":e,n),n);const sa=Math.random,ia=function t(e){function n(r,s){return r=r==null?0:+r,s=s==null?1:+s,arguments.length===1?(s=r,r=0):s-=r,function(){return e()*s+r}}return n.source=t,n}(sa),oa=1664525,aa=1013904223,ci=1/4294967296;function ua(t=Math.random()){let e=(0<=t&&t<1?t/ci:Math.abs(t))|0;return()=>(e=oa*e+aa|0,ci*(e>>>0))}var gr={};/**
 * @license MIT
 * @copyright 2020 Eyas Ranjous <eyas.ranjous@gmail.com>
 *
 * @class
 */let ca=class fr{constructor(e,n,r){if(typeof e!="function")throw new Error("Heap constructor expects a compare function");this._compare=e,this._nodes=Array.isArray(n)?n:[],this._leaf=r||null}toArray(){return Array.from(this._nodes)}_hasLeftChild(e){return e*2+1<this.size()}_hasRightChild(e){return e*2+2<this.size()}_compareAt(e,n){return this._compare(this._nodes[e],this._nodes[n])}_swap(e,n){const r=this._nodes[e];this._nodes[e]=this._nodes[n],this._nodes[n]=r}_shouldSwap(e,n){return e<0||e>=this.size()||n<0||n>=this.size()?!1:this._compareAt(e,n)>0}_compareChildrenOf(e){if(!this._hasLeftChild(e)&&!this._hasRightChild(e))return-1;const n=e*2+1,r=e*2+2;return this._hasLeftChild(e)?this._hasRightChild(e)&&this._compareAt(n,r)>0?r:n:r}_compareChildrenBefore(e,n,r){return this._compareAt(r,n)<=0&&r<e?r:n}_heapifyUp(e){let n=e,r=Math.floor((n-1)/2);for(;this._shouldSwap(r,n);)this._swap(r,n),n=r,r=Math.floor((n-1)/2)}_heapifyDown(e){let n=e,r=this._compareChildrenOf(n);for(;this._shouldSwap(n,r);)this._swap(n,r),n=r,r=this._compareChildrenOf(n)}_heapifyDownUntil(e){let n=0,r=1,s=2,i;for(;r<e;)i=this._compareChildrenBefore(e,r,s),this._shouldSwap(n,i)&&this._swap(n,i),n=i,r=n*2+1,s=n*2+2}insert(e){return this._nodes.push(e),this._heapifyUp(this.size()-1),(this._leaf===null||this._compare(e,this._leaf)>0)&&(this._leaf=e),this}push(e){return this.insert(e)}extractRoot(){if(this.isEmpty())return null;const e=this.root();return this._nodes[0]=this._nodes[this.size()-1],this._nodes.pop(),this._heapifyDown(0),e===this._leaf&&(this._leaf=this.root()),e}pop(){return this.extractRoot()}sort(){for(let e=this.size()-1;e>0;e-=1)this._swap(0,e),this._heapifyDownUntil(e);return this._nodes}fix(){for(let e=Math.floor(this.size()/2)-1;e>=0;e-=1)this._heapifyDown(e);for(let e=Math.floor(this.size()/2);e<this.size();e+=1){const n=this._nodes[e];(this._leaf===null||this._compare(n,this._leaf)>0)&&(this._leaf=n)}return this}isValid(){const e=n=>{let r=!0,s=!0;if(this._hasLeftChild(n)){const i=n*2+1;if(this._compareAt(n,i)>0)return!1;r=e(i)}if(this._hasRightChild(n)){const i=n*2+2;if(this._compareAt(n,i)>0)return!1;s=e(i)}return r&&s};return e(0)}clone(){return new fr(this._compare,this._nodes.slice(),this._leaf)}root(){return this.isEmpty()?null:this._nodes[0]}top(){return this.root()}leaf(){return this._leaf}size(){return this._nodes.length}isEmpty(){return this.size()===0}clear(){this._nodes=[],this._leaf=null}[Symbol.iterator](){let e=this.size();return{next:()=>(e-=1,{value:this.pop(),done:e===-1})}}static heapify(e,n){if(!Array.isArray(e))throw new Error("Heap.heapify expects an array of values");if(typeof n!="function")throw new Error("Heap.heapify expects a compare function");return new fr(n,e).fix()}static isHeapified(e,n){return new fr(n,e).isValid()}};gr.Heap=ca;var li={};/**
 * @license MIT
 * @copyright 2020 Eyas Ranjous <eyas.ranjous@gmail.com>
 */const{Heap:vr}=gr,br=t=>(e,n)=>{const r=typeof t=="function"?t(e):e,s=typeof t=="function"?t(n):n;return r<=s?-1:1};let la=class pr{constructor(e,n){this._getCompareValue=e,this._heap=n||new vr(br(e))}toArray(){return Array.from(this._heap._nodes)}insert(e){return this._heap.insert(e)}push(e){return this.insert(e)}extractRoot(){return this._heap.extractRoot()}pop(){return this.extractRoot()}sort(){return this._heap.sort()}fix(){return this._heap.fix()}isValid(){return this._heap.isValid()}root(){return this._heap.root()}top(){return this.root()}leaf(){return this._heap.leaf()}size(){return this._heap.size()}isEmpty(){return this._heap.isEmpty()}clear(){this._heap.clear()}clone(){return new pr(this._getCompareValue,this._heap.clone())}[Symbol.iterator](){let e=this.size();return{next:()=>(e-=1,{value:this.pop(),done:e===-1})}}static heapify(e,n){if(!Array.isArray(e))throw new Error("MinHeap.heapify expects an array");const r=new vr(br(n),e);return new pr(n,r).fix()}static isHeapified(e,n){const r=new vr(br(n),e);return new pr(n,r).isValid()}};li.MinHeap=la;var hi={};/**
 * @license MIT
 * @copyright 2020 Eyas Ranjous <eyas.ranjous@gmail.com>
 */const{Heap:_r}=gr,wr=t=>(e,n)=>{const r=typeof t=="function"?t(e):e,s=typeof t=="function"?t(n):n;return r<s?1:-1};let ha=class yr{constructor(e,n){this._getCompareValue=e,this._heap=n||new _r(wr(e))}insert(e){return this._heap.insert(e)}push(e){return this.insert(e)}extractRoot(){return this._heap.extractRoot()}pop(){return this.extractRoot()}sort(){return this._heap.sort()}toArray(){return Array.from(this._heap._nodes)}fix(){return this._heap.fix()}isValid(){return this._heap.isValid()}root(){return this._heap.root()}top(){return this.root()}leaf(){return this._heap.leaf()}size(){return this._heap.size()}isEmpty(){return this._heap.isEmpty()}clear(){this._heap.clear()}clone(){return new yr(this._getCompareValue,this._heap.clone())}[Symbol.iterator](){let e=this.size();return{next:()=>(e-=1,{value:this.pop(),done:e===-1})}}static heapify(e,n){if(!Array.isArray(e))throw new Error("MaxHeap.heapify expects an array");const r=new _r(wr(n),e);return new yr(n,r).fix()}static isHeapified(e,n){const r=new _r(wr(n),e);return new yr(n,r).isValid()}};hi.MaxHeap=ha;const{MinHeap:da}=li,{MaxHeap:fa}=hi;var fn=da,di=fa;const q=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,U=Object.keys,G=Array.isArray;function Z(t,e){return typeof e!="object"||U(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||q.Promise||(q.Promise=Promise);const Ct=Object.getPrototypeOf,pa={}.hasOwnProperty;function oe(t,e){return pa.call(t,e)}function ct(t,e){typeof e=="function"&&(e=e(Ct(t))),(typeof Reflect>"u"?U:Reflect.ownKeys)(e).forEach(n=>{_e(t,n,e[n])})}const fi=Object.defineProperty;function _e(t,e,n,r){fi(t,e,Z(n&&oe(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function lt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),_e(t.prototype,"constructor",t),{extend:ct.bind(null,t.prototype)}}}}const ya=Object.getOwnPropertyDescriptor;function xr(t,e){let n;return ya(t,e)||(n=Ct(t))&&xr(n,e)}const ma=[].slice;function pn(t,e,n){return ma.call(t,e,n)}function pi(t,e){return e(t)}function Kt(t){if(!t)throw new Error("Assertion Failed")}function yi(t){q.setImmediate?setImmediate(t):setTimeout(t,0)}function mi(t,e){return t.reduce((n,r,s)=>{var i=e(r,s);return i&&(n[i[0]]=i[1]),n},{})}function we(t,e){if(oe(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var i=we(t,e[r]);n.push(i)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:we(a,e.substr(o+1))}}function de(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Kt(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)de(t,e[r],n[r])}else{var i=e.indexOf(".");if(i!==-1){var o=e.substr(0,i),a=e.substr(i+1);if(a==="")n===void 0?G(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var u=t[o];u&&oe(t,o)||(u=t[o]={}),de(u,a,n)}}else n===void 0?G(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function gi(t){var e={};for(var n in t)oe(t,n)&&(e[n]=t[n]);return e}const ga=[].concat;function vi(t){return ga.apply([],t)}const bi="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(vi([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>q[t]),va=bi.map(t=>q[t]);mi(bi,t=>[t,!0]);let je=null;function Ot(t){je=typeof WeakMap<"u"&&new WeakMap;const e=kr(t);return je=null,e}function kr(t){if(!t||typeof t!="object")return t;let e=je&&je.get(t);if(e)return e;if(G(t)){e=[],je&&je.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(kr(t[n]))}else if(va.indexOf(t.constructor)>=0)e=t;else{const i=Ct(t);for(var s in e=i===Object.prototype?{}:Object.create(i),je&&je.set(t,e),t)oe(t,s)&&(e[s]=kr(t[s]))}return e}const{toString:ba}={};function Er(t){return ba.call(t).slice(8,-1)}const Pr=typeof Symbol<"u"?Symbol.iterator:"@@iterator",_a=typeof Pr=="symbol"?function(t){var e;return t!=null&&(e=t[Pr])&&e.apply(t)}:function(){return null},ht={};function xe(t){var e,n,r,s;if(arguments.length===1){if(G(t))return t.slice();if(this===ht&&typeof t=="string")return[t];if(s=_a(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const Sr=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var me=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function _i(t,e){me=t,wi=e}var wi=()=>!0;const wa=!new Error("").stack;function He(){if(wa)try{throw He.arguments,new Error}catch(t){return t}return new Error}function Cr(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(wi).map(r=>`
`+r).join("")):""}var xi=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Kr=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(xi),xa={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function dt(t,e){this._e=He(),this.name=t,this.message=e}function ki(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function yn(t,e,n,r){this._e=He(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=ki(t,e)}function Dt(t,e){this._e=He(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=ki(t,e)}lt(dt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+Cr(this._e,2))}},toString:function(){return this.name+": "+this.message}}),lt(yn).from(dt),lt(Dt).from(dt);var Or=Kr.reduce((t,e)=>(t[e]=e+"Error",t),{});const ka=dt;var A=Kr.reduce((t,e)=>{var n=e+"Error";function r(s,i){this._e=He(),this.name=n,s?typeof s=="string"?(this.message=`${s}${i?`
 `+i:""}`,this.inner=i||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=xa[e]||n,this.inner=null)}return lt(r).from(ka),t[e]=r,t},{});A.Syntax=SyntaxError,A.Type=TypeError,A.Range=RangeError;var Ei=xi.reduce((t,e)=>(t[e+"Error"]=A[e],t),{}),mn=Kr.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=A[e]),t),{});function F(){}function At(t){return t}function Ea(t,e){return t==null||t===At?e:function(n){return e(t(n))}}function We(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function Pa(t,e){return t===F?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?We(r,this.onsuccess):r),s&&(this.onerror=this.onerror?We(s,this.onerror):s),i!==void 0?i:n}}function Sa(t,e){return t===F?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?We(n,this.onsuccess):n),r&&(this.onerror=this.onerror?We(r,this.onerror):r)}}function Ca(t,e){return t===F?e:function(n){var r=t.apply(this,arguments);Z(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?We(s,this.onsuccess):s),i&&(this.onerror=this.onerror?We(i,this.onerror):i),r===void 0?o===void 0?void 0:o:Z(r,o)}}function Ka(t,e){return t===F?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Dr(t,e){return t===F?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}mn.ModifyError=yn,mn.DexieError=dt,mn.BulkError=Dt;var $t={};const Pi=100,[Ar,gn,$r]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Ct(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Ct(e),t]})(),Si=gn&&gn.then,vn=Ar&&Ar.constructor,Ir=!!$r;var jr=!1,Oa=$r?()=>{$r.then(xn)}:q.setImmediate?setImmediate.bind(null,xn):q.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{xn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(xn,0)},It=function(t,e){jt.push([t,e]),bn&&(Oa(),bn=!1)},Tr=!0,bn=!0,Ye=[],_n=[],Br=null,Mr=At,ft={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:Bi,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{Bi(t[0],t[1])}catch{}})}},O=ft,jt=[],Ge=0,wn=[];function S(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=F,this._lib=!1;var e=this._PSD=O;if(me&&(this._stackHolder=He(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==$t)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Fr(this,this._value))}this._state=null,this._value=null,++e.ref,Ki(this,t)}const Rr={get:function(){var t=O,e=Pn;function n(r,s){var i=!t.global&&(t!==O||e!==Pn);const o=i&&!ke();var a=new S((u,c)=>{Nr(this,new Ci(Cn(r,t,i,o),Cn(s,t,i,o),u,c,t))});return me&&Ai(a,this),a}return n.prototype=$t,n},set:function(t){_e(this,"then",t&&t.prototype===$t?Rr:{get:function(){return t},set:Rr.set})}};function Ci(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function Ki(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&Tt();n&&typeof n.then=="function"?Ki(t,(s,i)=>{n instanceof S?n._then(s,i):n.then(s,i)}):(t._state=!0,t._value=n,Oi(t)),r&&Bt()}},Fr.bind(null,t))}catch(n){Fr(t,n)}}function Fr(t,e){if(_n.push(e),t._state===null){var n=t._lib&&Tt();e=Mr(e),t._state=!1,t._value=e,me&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,i){try{r.apply(null,i)}catch(o){s&&s(o)}}(()=>{var r=xr(e,"stack");e._promise=t,_e(e,"stack",{get:()=>jr?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){Ye.some(s=>s._value===r._value)||Ye.push(r)}(t),Oi(t),n&&Bt()}}function Oi(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Nr(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),Ge===0&&(++Ge,It(()=>{--Ge==0&&qr()},[]))}function Nr(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ge,It(Da,[n,t,e])}else t._listeners.push(e)}function Da(t,e,n){try{Br=e;var r,s=e._value;e._state?r=t(s):(_n.length&&(_n=[]),r=t(s),_n.indexOf(s)===-1&&function(i){for(var o=Ye.length;o;)if(Ye[--o]._value===i._value)return void Ye.splice(o,1)}(e)),n.resolve(r)}catch(i){n.reject(i)}finally{Br=null,--Ge==0&&qr(),--n.psd.ref||n.psd.finalize()}}function Di(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,i,o=t._value;o!=null?(s=o.name||"Error",i=o.message||o,r=Cr(o,0)):(s=o,i=""),e.push(s+(i?": "+i:"")+r)}return me&&((r=Cr(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&Di(t._prev,e,n)),e}function Ai(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function xn(){Tt()&&Bt()}function Tt(){var t=Tr;return Tr=!1,bn=!1,t}function Bt(){var t,e,n;do for(;jt.length>0;)for(t=jt,jt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(jt.length>0);Tr=!0,bn=!0}function qr(){var t=Ye;Ye=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=wn.slice(0),n=e.length;n;)e[--n]()}function kn(t){return new S($t,!1,t)}function L(t,e){var n=O;return function(){var r=Tt(),s=O;try{return Be(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{Be(s,!1),r&&Bt()}}}ct(S.prototype,{then:Rr,_then:function(t,e){Nr(this,new Ci(null,null,t,e,O))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):kn(r)):this.then(null,r=>r&&r.name===e?n(r):kn(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),kn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{jr=!0;var t=Di(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{jr=!1}}},timeout:function(t,e){return t<1/0?new S((n,r)=>{var s=setTimeout(()=>r(new A.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&_e(S.prototype,Symbol.toStringTag,"Dexie.Promise"),ft.env=$i(),ct(S,{all:function(){var t=xe.apply(null,arguments).map(Sn);return new S(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,i)=>S.resolve(s).then(o=>{t[i]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof S)return t;if(t&&typeof t.then=="function")return new S((n,r)=>{t.then(n,r)});var e=new S($t,!0,t);return Ai(e,Br),e},reject:kn,race:function(){var t=xe.apply(null,arguments).map(Sn);return new S((e,n)=>{t.map(r=>S.resolve(r).then(e,n))})},PSD:{get:()=>O,set:t=>O=t},totalEchoes:{get:()=>Pn},newPSD:Te,usePSD:yt,scheduler:{get:()=>It,set:t=>{It=t}},rejectionMapper:{get:()=>Mr,set:t=>{Mr=t}},follow:(t,e)=>new S((n,r)=>Te((s,i)=>{var o=O;o.unhandleds=[],o.onunhandled=i,o.finalize=We(function(){(function(a){function u(){a(),wn.splice(wn.indexOf(u),1)}wn.push(u),++Ge,It(()=>{--Ge==0&&qr()},[])})(()=>{this.unhandleds.length===0?s():i(this.unhandleds[0])})},o.finalize),t()},e,n,r))}),vn&&(vn.allSettled&&_e(S,"allSettled",function(){const t=xe.apply(null,arguments).map(Sn);return new S(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,i)=>S.resolve(s).then(o=>r[i]={status:"fulfilled",value:o},o=>r[i]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),vn.any&&typeof AggregateError<"u"&&_e(S,"any",function(){const t=xe.apply(null,arguments).map(Sn);return new S((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((i,o)=>S.resolve(i).then(a=>e(a),a=>{s[o]=a,--r||n(new AggregateError(s))}))})}));const J={awaits:0,echoes:0,id:0};var Aa=0,En=[],zr=0,Pn=0,$a=0;function Te(t,e,n,r){var s=O,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++$a;var o=ft.env;i.env=Ir?{Promise:S,PromiseProp:{value:S,configurable:!0,writable:!0},all:S.all,race:S.race,allSettled:S.allSettled,any:S.any,resolve:S.resolve,reject:S.reject,nthen:ji(o.nthen,i),gthen:ji(o.gthen,i)}:{},e&&Z(i,e),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=yt(i,t,n,r);return i.ref===0&&i.finalize(),a}function pt(){return J.id||(J.id=++Aa),++J.awaits,J.echoes+=Pi,J.id}function ke(){return!!J.awaits&&(--J.awaits==0&&(J.id=0),J.echoes=J.awaits*Pi,!0)}function Sn(t){return J.echoes&&t&&t.constructor===vn?(pt(),t.then(e=>(ke(),e),e=>(ke(),W(e)))):t}function Ia(t){++Pn,J.echoes&&--J.echoes!=0||(J.echoes=J.id=0),En.push(O),Be(t,!0)}function ja(){var t=En[En.length-1];En.pop(),Be(t,!1)}function Be(t,e){var n=O;if((e?!J.echoes||zr++&&t===O:!zr||--zr&&t===O)||Ii(e?Ia.bind(null,t):ja),t!==O&&(O=t,n===ft&&(ft.env=$i()),Ir)){var r=ft.env.Promise,s=t.env;gn.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(q,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function $i(){var t=q.Promise;return Ir?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(q,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:gn.then,gthen:t.prototype.then}:{}}function yt(t,e,n,r,s){var i=O;try{return Be(t,!0),e(n,r,s)}finally{Be(i,!1)}}function Ii(t){Si.call(Ar,t)}function Cn(t,e,n,r){return typeof t!="function"?t:function(){var s=O;n&&pt(),Be(e,!0);try{return t.apply(this,arguments)}finally{Be(s,!1),r&&Ii(ke)}}}function ji(t,e){return function(n,r){return t.call(this,Cn(n,e),Cn(r,e))}}(""+Si).indexOf("[native code]")===-1&&(pt=ke=F);const Ti="unhandledrejection";function Bi(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(q.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Ti,!0,!0),Z(r,s)):q.CustomEvent&&Z(r=new CustomEvent(Ti,{detail:s}),s),r&&q.dispatchEvent&&(dispatchEvent(r),!q.PromiseRejectionEvent&&q.onunhandledrejection))try{q.onunhandledrejection(r)}catch{}me&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var W=S.reject;function Lr(t,e,n,r){if(t.idbdb&&(t._state.openComplete||O.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===Or.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Lr(t,e,n,r))):W(i)}return s._promise(e,(i,o)=>Te(()=>(O.trans=s,r(i,o,s)))).then(i=>s._completion.then(()=>i))}if(t._state.openComplete)return W(new A.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return W(new A.DatabaseClosed);t.open().catch(F)}return t._state.dbReadyPromise.then(()=>Lr(t,e,n,r))}const Mi="3.2.4",Je="ï¿¿",Vr=-1/0,Ee="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Ri="String expected.",Mt=[],Kn=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Ta=Kn,Ba=Kn,Fi=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),On="__dbnames",Ur="readonly",Hr="readwrite";function Qe(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Ni={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Dn(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=Ot(e))[t],e)}class Ma{_trans(e,n,r){const s=this._tx||O.trans,i=this.name;function o(u,c,h){if(!h.schema[i])throw new A.NotFound("Table "+i+" not part of transaction");return n(h.idbtrans,h)}const a=Tt();try{return s&&s.db===this.db?s===O.trans?s._promise(e,o,r):Te(()=>s._promise(e,o,r),{trans:s,transless:O.transless||O}):Lr(this.db,e,[this.name],o)}finally{a&&Bt()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(G(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=U(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&n.every(h=>c.keyPath.indexOf(h)>=0)&&c.keyPath.every(h=>n.indexOf(h)>=0))[0];if(r&&this.db._maxKey!==Je)return this.where(r.name).equals(r.keyPath.map(c=>e[c]));!r&&me&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function o(c,h){try{return i.cmp(c,h)===0}catch{return!1}}const[a,u]=n.reduce(([c,h],l)=>{const d=s[l],f=e[l];return[c||d,c||!d?Qe(h,d&&d.multi?m=>{const p=we(m,l);return G(p)&&p.some(v=>o(f,v))}:m=>o(f,we(m,l))):h]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(u):r?this.filter(u):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,G(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var i in r)if(oe(r,i))try{s[i]=r[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){Z(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=Dn(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[i]})).then(o=>o.numFailures?S.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{de(e,s,o)}catch{}return o})}update(e,n){if(typeof e!="object"||G(e))return this.where(":id").equals(e).modify(n);{const r=we(e,this.schema.primKey.keyPath);if(r===void 0)return W(new A.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?U(n).forEach(s=>{de(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=Dn(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:n!=null?[n]:null})).then(o=>o.numFailures?S.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{de(e,s,o)}catch{}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?S.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Ni})).then(e=>e.numFailures?S.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&s)throw new A.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&a?e.map(Dn(u)):e;return this.core.mutate({trans:o,type:"add",keys:s,values:h,wantResults:i}).then(({numFailures:l,results:d,lastResult:f,failures:m})=>{if(l===0)return i?d:f;throw new Dt(`${this.name}.bulkAdd(): ${l} of ${c} operations failed`,m)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&s)throw new A.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new A.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&a?e.map(Dn(u)):e;return this.core.mutate({trans:o,type:"put",keys:s,values:h,wantResults:i}).then(({numFailures:l,results:d,lastResult:f,failures:m})=>{if(l===0)return i?d:f;throw new Dt(`${this.name}.bulkPut(): ${l} of ${c} operations failed`,m)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:i})=>{if(r===0)return s;throw new Dt(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,i)})}}function Rt(t){var e={},n=function(o,a){if(a){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[o].subscribe.apply(null,c),t}if(typeof o=="string")return e[o]};n.addEventType=i;for(var r=1,s=arguments.length;r<s;++r)i(arguments[r]);return n;function i(o,a,u){if(typeof o!="object"){var c;a||(a=Ka),u||(u=F);var h={subscribers:[],fire:u,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=a(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(d){return d!==l}),h.fire=h.subscribers.reduce(a,u)}};return e[o]=n[o]=h,h}U(c=o).forEach(function(l){var d=c[l];if(G(d))i(l,c[l][0],c[l][1]);else{if(d!=="asap")throw new A.InvalidArgument("Invalid event config");var f=i(l,At,function(){for(var m=arguments.length,p=new Array(m);m--;)p[m]=arguments[m];f.subscribers.forEach(function(v){yi(function(){v.apply(null,p)})})})}})}}function Ft(t,e){return lt(e).from({prototype:t}),e}function mt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Wr(t,e){t.filter=Qe(t.filter,e)}function Yr(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>Qe(r(),e()):e,t.justLimit=n&&!r}function An(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new A.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function qi(t,e,n){const r=An(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function $n(t,e,n,r){const s=t.replayFilter?Qe(t.filter,t.replayFilter()):t.filter;if(t.or){const i={},o=(a,u,c)=>{if(!s||s(u,c,d=>u.stop(d),d=>u.fail(d))){var h=u.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),oe(i,l)||(i[l]=!0,e(a,u,c))}};return Promise.all([t.or._iterate(o,n),zi(qi(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return zi(qi(t,r,n),Qe(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function zi(t,e,n,r){var s=L(r?(i,o,a)=>n(r(i),o,a):n);return t.then(i=>{if(i)return i.start(()=>{var o=()=>i.continue();e&&!e(i,a=>o=a,a=>{i.stop(a),o=F},a=>{i.fail(a),o=F})||s(i.value,i,a=>o=a),o()})})}function ee(t,e){try{const n=Li(t),r=Li(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,i){const o=s.length,a=i.length,u=o<a?o:a;for(let c=0;c<u;++c)if(s[c]!==i[c])return s[c]<i[c]?-1:1;return o===a?0:o<a?-1:1}(Vi(t),Vi(e));case"Array":return function(s,i){const o=s.length,a=i.length,u=o<a?o:a;for(let c=0;c<u;++c){const h=ee(s[c],i[c]);if(h!==0)return h}return o===a?0:o<a?-1:1}(t,e)}}catch{}return NaN}function Li(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=Er(t);return n==="ArrayBuffer"?"binary":n}function Vi(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class Ra{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,W.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,W.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=Qe(n.algorithm,e)}_iterate(e,n){return $n(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&Z(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>$n(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(mt(r,!0))return s.count({trans:n,query:{index:An(r,s.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var i=0;return $n(r,()=>(++i,!1),n,s).then(()=>i)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],i=r.length-1;function o(c,h){return h?o(c[r[h]],h-1):c[s]}var a=this._ctx.dir==="next"?1:-1;function u(c,h){var l=o(c,i),d=o(h,i);return l<d?-a:l>d?a:0}return this.toArray(function(c){return c.sort(u)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&mt(r,!0)&&r.limit>0){const{valueMapper:s}=r,i=An(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(({result:o})=>s?o.map(s):o)}{const s=[];return $n(r,i=>s.push(i),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,mt(n)?Yr(n,()=>{var r=e;return(s,i)=>r===0||(r===1?(--r,!1):(i(()=>{s.advance(r),r=0}),!1))}):Yr(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Yr(this._ctx,()=>{var n=e;return function(r,s,i){return--n<=0&&s(i),n>=0}},!0),this}until(e,n){return Wr(this._ctx,function(r,s,i){return!e(r.value)||(s(i),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Wr(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=Qe(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&mt(n,!0)&&n.limit>0)return this._read(s=>{var i=An(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:i,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Wr(this._ctx,function(s){var i=s.primaryKey.toString(),o=oe(r,i);return r[i]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var i=U(e),o=i.length;s=function(p){for(var v=!1,g=0;g<o;++g){var y=i[g],b=e[y];we(p,y)!==b&&(de(p,y,b),v=!0)}return v}}const a=n.table.core,{outbound:u,extractKey:c}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,l=[];let d=0;const f=[],m=(p,v)=>{const{failures:g,numFailures:y}=v;d+=p-y;for(let b of U(g))l.push(g[b])};return this.clone().primaryKeys().then(p=>{const v=g=>{const y=Math.min(h,p.length-g);return a.getMany({trans:r,keys:p.slice(g,g+y),cache:"immutable"}).then(b=>{const k=[],E=[],x=u?[]:null,_=[];for(let w=0;w<y;++w){const I=b[w],K={value:Ot(I),primKey:p[g+w]};s.call(K,K.value,K)!==!1&&(K.value==null?_.push(p[g+w]):u||ee(c(I),c(K.value))===0?(E.push(K.value),u&&x.push(p[g+w])):(_.push(p[g+w]),k.push(K.value)))}const P=mt(n)&&n.limit===1/0&&(typeof e!="function"||e===Gr)&&{index:n.index,range:n.range};return Promise.resolve(k.length>0&&a.mutate({trans:r,type:"add",values:k}).then(w=>{for(let I in w.failures)_.splice(parseInt(I),1);m(k.length,w)})).then(()=>(E.length>0||P&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:x,values:E,criteria:P,changeSpec:typeof e!="function"&&e}).then(w=>m(E.length,w))).then(()=>(_.length>0||P&&e===Gr)&&a.mutate({trans:r,type:"delete",keys:_,criteria:P}).then(w=>m(_.length,w))).then(()=>p.length>g+y&&v(g+h))})};return v(0).then(()=>{if(l.length>0)throw new yn("Error modifying one or more objects",l,d,f);return p.length})})})}delete(){var e=this._ctx,n=e.range;return mt(e)&&(e.isPrimKey&&!Ba||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,i=n;return e.table.core.count({trans:r,query:{index:s,range:i}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then(({failures:a,lastResult:u,results:c,numFailures:h})=>{if(h)throw new yn("Could not delete some values",Object.keys(a).map(l=>a[l]),o-h);return o-h}))}):this.modify(Gr)}}const Gr=(t,e)=>e.value=null;function Fa(t,e){return t<e?-1:t===e?0:1}function Na(t,e){return t>e?-1:t===e?0:1}function ae(t,e,n){var r=t instanceof Hi?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function gt(t){return new t.Collection(t,()=>Ui("")).limit(0)}function qa(t,e,n,r,s,i){for(var o=Math.min(t.length,r.length),a=-1,u=0;u<o;++u){var c=e[u];if(c!==r[u])return s(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):s(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;s(t[u],c)<0&&(a=u)}return o<r.length&&i==="next"?t+n.substr(t.length):o<t.length&&i==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function In(t,e,n,r){var s,i,o,a,u,c,h,l=n.length;if(!n.every(p=>typeof p=="string"))return ae(t,Ri);function d(p){s=function(g){return g==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(p),i=function(g){return g==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(p),o=p==="next"?Fa:Na;var v=n.map(function(g){return{lower:i(g),upper:s(g)}}).sort(function(g,y){return o(g.lower,y.lower)});a=v.map(function(g){return g.upper}),u=v.map(function(g){return g.lower}),c=p,h=p==="next"?"":r}d("next");var f=new t.Collection(t,()=>Me(a[0],u[l-1]+r));f._ondirectionchange=function(p){d(p)};var m=0;return f._addAlgorithm(function(p,v,g){var y=p.key;if(typeof y!="string")return!1;var b=i(y);if(e(b,u,m))return!0;for(var k=null,E=m;E<l;++E){var x=qa(y,b,a[E],u[E],o,c);x===null&&k===null?m=E+1:(k===null||o(k,x)>0)&&(k=x)}return v(k!==null?function(){p.continue(k+h)}:g),!1}),f}function Me(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Ui(t){return{type:1,lower:t,upper:t}}class Hi{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?gt(this):new this.Collection(this,()=>Me(e,n,!r,!s))}catch{return ae(this,Ee)}}equals(e){return e==null?ae(this,Ee):new this.Collection(this,()=>Ui(e))}above(e){return e==null?ae(this,Ee):new this.Collection(this,()=>Me(e,void 0,!0))}aboveOrEqual(e){return e==null?ae(this,Ee):new this.Collection(this,()=>Me(e,void 0,!1))}below(e){return e==null?ae(this,Ee):new this.Collection(this,()=>Me(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ae(this,Ee):new this.Collection(this,()=>Me(void 0,e))}startsWith(e){return typeof e!="string"?ae(this,Ri):this.between(e,e+Je,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):In(this,(n,r)=>n.indexOf(r[0])===0,[e],Je)}equalsIgnoreCase(e){return In(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=xe.apply(ht,arguments);return e.length===0?gt(this):In(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=xe.apply(ht,arguments);return e.length===0?gt(this):In(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,Je)}anyOf(){const e=xe.apply(ht,arguments);let n=this._cmp;try{e.sort(n)}catch{return ae(this,Ee)}if(e.length===0)return gt(this);const r=new this.Collection(this,()=>Me(e[0],e[e.length-1]));r._ondirectionchange=i=>{n=i==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((i,o,a)=>{const u=i.key;for(;n(u,e[s])>0;)if(++s,s===e.length)return o(a),!1;return n(u,e[s])===0||(o(()=>{i.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[Vr,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=xe.apply(ht,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ae(this,Ee)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Vr,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,i=this._descending,o=this._min,a=this._max;if(e.length===0)return gt(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&s(y[0],y[1])<=0))return ae(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",A.InvalidArgument);const u=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;let h,l=s;function d(y,b){return l(y[0],b[0])}try{h=e.reduce(function(y,b){let k=0,E=y.length;for(;k<E;++k){const x=y[k];if(r(b[0],x[1])<0&&r(b[1],x[0])>0){x[0]=o(x[0],b[0]),x[1]=a(x[1],b[1]);break}}return k===E&&y.push(b),y},[]),h.sort(d)}catch{return ae(this,Ee)}let f=0;const m=c?y=>s(y,h[f][1])>0:y=>s(y,h[f][1])>=0,p=u?y=>i(y,h[f][0])>0:y=>i(y,h[f][0])>=0;let v=m;const g=new this.Collection(this,()=>Me(h[0][0],h[h.length-1][1],!u,!c));return g._ondirectionchange=y=>{y==="next"?(v=m,l=s):(v=p,l=i),h.sort(d)},g._addAlgorithm((y,b,k)=>{for(var E=y.key;v(E);)if(++f,f===h.length)return b(k),!1;return!!function(x){return!m(x)&&!p(x)}(E)||(this._cmp(E,h[f][1])===0||this._cmp(E,h[f][0])===0||b(()=>{l===s?y.continue(h[f][0]):y.continue(h[f][1])}),!1)}),g}startsWithAnyOf(){const e=xe.apply(ht,arguments);return e.every(n=>typeof n=="string")?e.length===0?gt(this):this.inAnyRange(e.map(n=>[n,n+Je])):ae(this,"startsWithAnyOf() only works with strings")}}function ge(t){return L(function(e){return Nt(e),t(e.target.error),!1})}function Nt(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const qt="storagemutated",Re="x-storagemutated-1",Fe=Rt(null,qt);class za{_lock(){return Kt(!O.global),++this._reculock,this._reculock!==1||O.global||(O.lockOwnerFor=this),this}_unlock(){if(Kt(!O.global),--this._reculock==0)for(O.global||(O.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{yt(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&O.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Kt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new A.DatabaseClosed(r);case"MissingAPIError":throw new A.MissingAPI(r.message,r);default:throw new A.OpenFailed(r)}if(!this.active)throw new A.TransactionInactive;return Kt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=L(s=>{Nt(s),this._reject(e.error)}),e.onabort=L(s=>{Nt(s),this.active&&this._reject(new A.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=L(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Fe.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return W(new A.ReadOnly("Transaction is readonly"));if(!this.active)return W(new A.TransactionInactive);if(this._locked())return new S((i,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(i,o)},O])});if(r)return Te(()=>{var i=new S((o,a)=>{this._lock();const u=n(o,a,this);u&&u.then&&u.then(o,a)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new S((i,o)=>{var a=n(i,o,this);a&&a.then&&a.then(i,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=S.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=o)})()}var i=n._waitingFor;return new S((o,a)=>{r.then(u=>n._waitingQueue.push(L(o.bind(null,u))),u=>n._waitingQueue.push(L(a.bind(null,u)))).finally(()=>{n._waitingFor===i&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new A.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(oe(n,e))return n[e];const r=this.schema[e];if(!r)throw new A.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function Jr(t,e,n,r,s,i,o){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(s?"++":"")+Wi(e)}}function Wi(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Yi(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:mi(n,r=>[r.name,r])}}let zt=t=>{try{return t.only([[]]),zt=()=>[[]],[[]]}catch{return zt=()=>Je,Je}};function Qr(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>we(n,e)}(t):e=>we(e,t)}function Gi(t){return[].slice.call(t)}let La=0;function Lt(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function Va(t,e,n){function r(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:h,lowerOpen:l,upperOpen:d}=u;return c===void 0?h===void 0?null:e.upperBound(h,!!d):h===void 0?e.lowerBound(c,!!l):e.bound(c,h,!!l,!!d)}const{schema:s,hasGetAll:i}=function(u,c){const h=Gi(u.objectStoreNames);return{schema:{name:u.name,tables:h.map(l=>c.objectStore(l)).map(l=>{const{keyPath:d,autoIncrement:f}=l,m=G(d),p=d==null,v={},g={name:l.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:m,keyPath:d,autoIncrement:f,unique:!0,extractKey:Qr(d)},indexes:Gi(l.indexNames).map(y=>l.index(y)).map(y=>{const{name:b,unique:k,multiEntry:E,keyPath:x}=y,_={name:b,compound:G(x),keyPath:x,unique:k,multiEntry:E,extractKey:Qr(x)};return v[Lt(x)]=_,_}),getIndexByKeyPath:y=>v[Lt(y)]};return v[":id"]=g.primaryKey,d!=null&&(v[Lt(d)]=g.primaryKey),g})},hasGetAll:h.length>0&&"getAll"in c.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),o=s.tables.map(u=>function(c){const h=c.name;return{name:h,schema:c,mutate:function({trans:l,type:d,keys:f,values:m,range:p}){return new Promise((v,g)=>{v=L(v);const y=l.objectStore(h),b=y.keyPath==null,k=d==="put"||d==="add";if(!k&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:E}=f||m||{length:1};if(f&&m&&f.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return v({numFailures:0,failures:{},results:[],lastResult:void 0});let x;const _=[],P=[];let w=0;const I=M=>{++w,Nt(M)};if(d==="deleteRange"){if(p.type===4)return v({numFailures:w,failures:P,results:[],lastResult:void 0});p.type===3?_.push(x=y.clear()):_.push(x=y.delete(r(p)))}else{const[M,T]=k?b?[m,f]:[m,null]:[f,null];if(k)for(let j=0;j<E;++j)_.push(x=T&&T[j]!==void 0?y[d](M[j],T[j]):y[d](M[j])),x.onerror=I;else for(let j=0;j<E;++j)_.push(x=y[d](M[j])),x.onerror=I}const K=M=>{const T=M.target.result;_.forEach((j,le)=>j.error!=null&&(P[le]=j.error)),v({numFailures:w,failures:P,results:d==="delete"?f:_.map(j=>j.result),lastResult:T})};x.onerror=M=>{I(M),K(M)},x.onsuccess=K})},getMany:({trans:l,keys:d})=>new Promise((f,m)=>{f=L(f);const p=l.objectStore(h),v=d.length,g=new Array(v);let y,b=0,k=0;const E=_=>{const P=_.target;g[P._pos]=P.result,++k===b&&f(g)},x=ge(m);for(let _=0;_<v;++_)d[_]!=null&&(y=p.get(d[_]),y._pos=_,y.onsuccess=E,y.onerror=x,++b);b===0&&f(g)}),get:({trans:l,key:d})=>new Promise((f,m)=>{f=L(f);const p=l.objectStore(h).get(d);p.onsuccess=v=>f(v.target.result),p.onerror=ge(m)}),query:function(l){return d=>new Promise((f,m)=>{f=L(f);const{trans:p,values:v,limit:g,query:y}=d,b=g===1/0?void 0:g,{index:k,range:E}=y,x=p.objectStore(h),_=k.isPrimaryKey?x:x.index(k.name),P=r(E);if(g===0)return f({result:[]});if(l){const w=v?_.getAll(P,b):_.getAllKeys(P,b);w.onsuccess=I=>f({result:I.target.result}),w.onerror=ge(m)}else{let w=0;const I=v||!("openKeyCursor"in _)?_.openCursor(P):_.openKeyCursor(P),K=[];I.onsuccess=M=>{const T=I.result;return T?(K.push(v?T.value:T.primaryKey),++w===g?f({result:K}):void T.continue()):f({result:K})},I.onerror=ge(m)}})}(i),openCursor:function({trans:l,values:d,query:f,reverse:m,unique:p}){return new Promise((v,g)=>{v=L(v);const{index:y,range:b}=f,k=l.objectStore(h),E=y.isPrimaryKey?k:k.index(y.name),x=m?p?"prevunique":"prev":p?"nextunique":"next",_=d||!("openKeyCursor"in E)?E.openCursor(r(b),x):E.openKeyCursor(r(b),x);_.onerror=ge(g),_.onsuccess=L(P=>{const w=_.result;if(!w)return void v(null);w.___id=++La,w.done=!1;const I=w.continue.bind(w);let K=w.continuePrimaryKey;K&&(K=K.bind(w));const M=w.advance.bind(w),T=()=>{throw new Error("Cursor not stopped")};w.trans=l,w.stop=w.continue=w.continuePrimaryKey=w.advance=()=>{throw new Error("Cursor not started")},w.fail=L(g),w.next=function(){let j=1;return this.start(()=>j--?this.continue():this.stop()).then(()=>this)},w.start=j=>{const le=new Promise((R,se)=>{R=L(R),_.onerror=ge(se),w.fail=se,w.stop=ye=>{w.stop=w.continue=w.continuePrimaryKey=w.advance=T,R(ye)}}),he=()=>{if(_.result)try{j()}catch(R){w.fail(R)}else w.done=!0,w.start=()=>{throw new Error("Cursor behind last entry")},w.stop()};return _.onsuccess=L(R=>{_.onsuccess=he,he()}),w.continue=I,w.continuePrimaryKey=K,w.advance=M,he(),le},v(w)},g)})},count({query:l,trans:d}){const{index:f,range:m}=l;return new Promise((p,v)=>{const g=d.objectStore(h),y=f.isPrimaryKey?g:g.index(f.name),b=r(m),k=b?y.count(b):y.count();k.onsuccess=L(E=>p(E.target.result)),k.onerror=ge(v)})}}}(u)),a={};return o.forEach(u=>a[u.name]=u),{stack:"dbcore",transaction:t.transaction.bind(t),table(u){if(!a[u])throw new Error(`Table '${u}' not found`);return a[u]},MIN_KEY:-1/0,MAX_KEY:zt(e),schema:s}}function Xr({_novip:t},e){const n=e.db,r=function(s,i,{IDBKeyRange:o,indexedDB:a},u){return{dbcore:function(c,h){return h.reduce((l,{create:d})=>({...l,...d(l)}),c)}(Va(i,o,u),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const i=s.name;t.core.schema.tables.some(o=>o.name===i)&&(s.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=s.core))})}function jn({_novip:t},e,n,r){n.forEach(s=>{const i=r[s];e.forEach(o=>{const a=xr(o,s);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?_e(o,s,{get(){return this.table(s)},set(u){fi(this,s,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new t.Table(s,i))})})}function Zr({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function Ua(t,e){return t._cfg.version-e._cfg.version}function Ha(t,e,n,r){const s=t._dbSchema,i=t._createTransaction("readwrite",t._storeNames,s);i.create(n),i._completion.catch(r);const o=i._reject.bind(i),a=O.transless||O;Te(()=>{O.trans=i,O.transless=a,e===0?(U(s).forEach(u=>{es(n,u,s[u].primKey,s[u].indexes)}),Xr(t,n),S.follow(()=>t.on.populate.fire(i)).catch(o)):function({_novip:u},c,h,l){const d=[],f=u._versions;let m=u._dbSchema=ns(u,u.idbdb,l),p=!1;const v=f.filter(y=>y._cfg.version>=c);function g(){return d.length?S.resolve(d.shift()(h.idbtrans)).then(g):S.resolve()}return v.forEach(y=>{d.push(()=>{const b=m,k=y._cfg.dbschema;rs(u,b,l),rs(u,k,l),m=u._dbSchema=k;const E=Ji(b,k);E.add.forEach(_=>{es(l,_[0],_[1].primKey,_[1].indexes)}),E.change.forEach(_=>{if(_.recreate)throw new A.Upgrade("Not yet support for changing primary key");{const P=l.objectStore(_.name);_.add.forEach(w=>ts(P,w)),_.change.forEach(w=>{P.deleteIndex(w.name),ts(P,w)}),_.del.forEach(w=>P.deleteIndex(w))}});const x=y._cfg.contentUpgrade;if(x&&y._cfg.version>c){Xr(u,l),h._memoizedTables={},p=!0;let _=gi(k);E.del.forEach(K=>{_[K]=b[K]}),Zr(u,[u.Transaction.prototype]),jn(u,[u.Transaction.prototype],U(_),_),h.schema=_;const P=Sr(x);let w;P&&pt();const I=S.follow(()=>{if(w=x(h),w&&P){var K=ke.bind(null,null);w.then(K,K)}});return w&&typeof w.then=="function"?S.resolve(w):I.then(()=>w)}}),d.push(b=>{(!p||!Ta)&&function(k,E){[].slice.call(E.db.objectStoreNames).forEach(x=>k[x]==null&&E.db.deleteObjectStore(x))}(y._cfg.dbschema,b),Zr(u,[u.Transaction.prototype]),jn(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),h.schema=u._dbSchema})}),g().then(()=>{var y,b;b=l,U(y=m).forEach(k=>{b.db.objectStoreNames.contains(k)||es(b,k,y[k].primKey,y[k].indexes)})})}(t,e,i,n).catch(o)})}function Ji(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],i=e[r];if(s){const o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!Kn)o.recreate=!0,n.change.push(o);else{const a=s.idxByName,u=i.idxByName;let c;for(c in a)u[c]||o.del.push(c);for(c in u){const h=a[c],l=u[c];h?h.src!==l.src&&o.change.push(l):o.add.push(l)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,i])}return n}function es(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(i=>ts(s,i)),s}function ts(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function ns(t,e,n){const r={};return pn(e.objectStoreNames,0).forEach(s=>{const i=n.objectStore(s);let o=i.keyPath;const a=Jr(Wi(o),o||"",!1,!1,!!i.autoIncrement,o&&typeof o!="string",!0),u=[];for(let h=0;h<i.indexNames.length;++h){const l=i.index(i.indexNames[h]);o=l.keyPath;var c=Jr(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);u.push(c)}r[s]=Yi(s,a,u)}),r}function rs({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],o=n.objectStore(i);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const u=o.indexNames[a],c=o.index(u).keyPath,h=typeof c=="string"?c:"["+pn(c).join("+")+"]";if(e[i]){const l=e[i].idxByName[h];l&&(l.name=u,delete e[i].idxByName[h],e[i].idxByName[u]=l)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&q.WorkerGlobalScope&&q instanceof q.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class Wa{_parseStoresSpec(e,n){U(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((o,a)=>{const u=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Jr(u,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),G(c),a===0)}),i=s.shift();if(i.multi)throw new A.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new A.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new A.Schema("Index must have a name and cannot be an empty string")}),n[r]=Yi(r,i,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?Z(this._cfg.storesSource,e):e;const r=n._versions,s={};let i={};return r.forEach(o=>{Z(s,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(s,i)}),n._dbSchema=i,Zr(n,[n._allTables,n,n.Transaction.prototype]),jn(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],U(i),i),n._storeNames=U(i),this}upgrade(e){return this._cfg.contentUpgrade=Dr(this._cfg.contentUpgrade||F,e),this}}function ss(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new hs(On,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function is(t){return t&&typeof t.databases=="function"}function os(t){return Te(function(){return O.letThrough=!0,t()})}function Ya(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function Ga(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?W(e.dbOpenError):t);me&&(e.openCanceller._stackHolder=He()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new A.DatabaseClosed("db.open() was cancelled")}let i=e.dbReadyResolve,o=null,a=!1;return S.race([r,(typeof navigator>"u"?S.resolve():Ya()).then(()=>new S((u,c)=>{if(s(),!n)throw new A.MissingAPI;const h=t.name,l=e.autoSchema?n.open(h):n.open(h,Math.round(10*t.verno));if(!l)throw new A.MissingAPI;l.onerror=ge(c),l.onblocked=L(t._fireOnBlocked),l.onupgradeneeded=L(d=>{if(o=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=Nt,o.abort(),l.result.close();const m=n.deleteDatabase(h);m.onsuccess=m.onerror=L(()=>{c(new A.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=ge(c);var f=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=f<1,t._novip.idbdb=l.result,Ha(t,f/10,o,c)}},c),l.onsuccess=L(()=>{o=null;const d=t._novip.idbdb=l.result,f=pn(d.objectStoreNames);if(f.length>0)try{const p=d.transaction((m=f).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:v},g,y){v.verno=g.version/10;const b=v._dbSchema=ns(0,g,y);v._storeNames=pn(g.objectStoreNames,0),jn(v,[v._allTables],U(b),b)}(t,d,p):(rs(t,t._dbSchema,p),function(v,g){const y=Ji(ns(0,v.idbdb,g),v._dbSchema);return!(y.add.length||y.change.some(b=>b.add.length||b.change.length))}(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Xr(t,p)}catch{}var m;Mt.push(t),d.onversionchange=L(p=>{e.vcFired=!0,t.on("versionchange").fire(p)}),d.onclose=L(p=>{t.on("close").fire(p)}),a&&function({indexedDB:p,IDBKeyRange:v},g){!is(p)&&g!==On&&ss(p,v).put({name:g}).catch(F)}(t._deps,h),u()},c)}))]).then(()=>(s(),e.onReadyBeingFired=[],S.resolve(os(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(Dr,F);return e.onReadyBeingFired=[],S.resolve(os(()=>c(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),W(u)}).finally(()=>{e.openComplete=!0,i()})}function as(t){var e=i=>t.next(i),n=s(e),r=s(i=>t.throw(i));function s(i){return o=>{var a=i(o),u=a.value;return a.done?u:u&&typeof u.then=="function"?u.then(n,r):G(u)?Promise.all(u).then(n,r):n(u)}}return s(e)()}function Ja(t,e,n){var r=arguments.length;if(r<2)throw new A.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,vi(s),n]}function Qi(t,e,n,r,s){return S.resolve().then(()=>{const i=O.transless||O,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:i};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===Or.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Qi(t,e,n,null,s))):W(l)}const u=Sr(s);let c;u&&pt();const h=S.follow(()=>{if(c=s.call(o,o),c)if(u){var l=ke.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=as(c))},a);return(c&&typeof c.then=="function"?S.resolve(c).then(l=>o.active?l:W(new A.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(l=>(r&&o._resolve(),o._completion.then(()=>l))).catch(l=>(o._reject(l),W(l)))})}function Tn(t,e,n){const r=G(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const Qa={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},i=[];function o(c,h,l){const d=Lt(c),f=s[d]=s[d]||[],m=c==null?0:typeof c=="string"?1:c.length,p=h>0,v={...l,isVirtual:p,keyTail:h,keyLength:m,extractKey:Qr(c),unique:!p&&l.unique};return f.push(v),v.isPrimaryKey||i.push(v),m>1&&o(m===2?c[0]:c.slice(0,m-1),h+1,l),f.sort((g,y)=>g.keyTail-y.keyTail),v}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const c of r.indexes)o(c.keyPath,0,c);function u(c){const h=c.query.index;return h.isVirtual?{...c,query:{index:h,range:(l=c.query.range,d=h.keyTail,{type:l.type===1?2:l.type,lower:Tn(l.lower,l.lowerOpen?t.MAX_KEY:t.MIN_KEY,d),lowerOpen:!0,upper:Tn(l.upper,l.upperOpen?t.MIN_KEY:t.MAX_KEY,d),upperOpen:!0})}}:c;var l,d}return{...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function(c){const h=s[Lt(c)];return h&&h[0]}},count:c=>n.count(u(c)),query:c=>n.query(u(c)),openCursor(c){const{keyTail:h,isVirtual:l,keyLength:d}=c.query.index;return l?n.openCursor(u(c)).then(f=>f&&function(m){return Object.create(m,{continue:{value:function(p){p!=null?m.continue(Tn(p,c.reverse?t.MAX_KEY:t.MIN_KEY,h)):c.unique?m.continue(m.key.slice(0,d).concat(c.reverse?t.MIN_KEY:t.MAX_KEY,h)):m.continue()}},continuePrimaryKey:{value(p,v){m.continuePrimaryKey(Tn(p,t.MAX_KEY,h),v)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const p=m.key;return d===1?p[0]:p.slice(0,d)}},value:{get:()=>m.value}})}(f)):n.openCursor(c)}}}}}};function us(t,e,n,r){return n=n||{},r=r||"",U(t).forEach(s=>{if(oe(e,s)){var i=t[s],o=e[s];if(typeof i=="object"&&typeof o=="object"&&i&&o){const a=Er(i);a!==Er(o)?n[r+s]=e[s]:a==="Object"?us(i,o,n,r+s+"."):i!==o&&(n[r+s]=e[s])}else i!==o&&(n[r+s]=e[s])}else n[r+s]=void 0}),U(e).forEach(s=>{oe(t,s)||(n[r+s]=e[s])}),n}const Xa={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(s){const i=O.trans,{deleting:o,creating:a,updating:u}=i.table(e).hook;switch(s.type){case"add":if(a.fire===F)break;return i._promise("readwrite",()=>c(s),!0);case"put":if(a.fire===F&&u.fire===F)break;return i._promise("readwrite",()=>c(s),!0);case"delete":if(o.fire===F)break;return i._promise("readwrite",()=>c(s),!0);case"deleteRange":if(o.fire===F)break;return i._promise("readwrite",()=>function(l){return h(l.trans,l.range,1e4)}(s),!0)}return n.mutate(s);function c(l){const d=O.trans,f=l.keys||function(m,p){return p.type==="delete"?p.keys:p.keys||p.values.map(m.extractKey)}(r,l);if(!f)throw new Error("Keys missing");return(l=l.type==="add"||l.type==="put"?{...l,keys:f}:{...l}).type!=="delete"&&(l.values=[...l.values]),l.keys&&(l.keys=[...l.keys]),function(m,p,v){return p.type==="add"?Promise.resolve([]):m.getMany({trans:p.trans,keys:v,cache:"immutable"})}(n,l,f).then(m=>{const p=f.map((v,g)=>{const y=m[g],b={onerror:null,onsuccess:null};if(l.type==="delete")o.fire.call(b,v,y,d);else if(l.type==="add"||y===void 0){const k=a.fire.call(b,v,l.values[g],d);v==null&&k!=null&&(v=k,l.keys[g]=v,r.outbound||de(l.values[g],r.keyPath,v))}else{const k=us(y,l.values[g]),E=u.fire.call(b,k,v,y,d);if(E){const x=l.values[g];Object.keys(E).forEach(_=>{oe(x,_)?x[_]=E[_]:de(x,_,E[_])})}}return b});return n.mutate(l).then(({failures:v,results:g,numFailures:y,lastResult:b})=>{for(let k=0;k<f.length;++k){const E=g?g[k]:f[k],x=p[k];E==null?x.onerror&&x.onerror(v[k]):x.onsuccess&&x.onsuccess(l.type==="put"&&m[k]?l.values[k]:E)}return{failures:v,results:g,numFailures:y,lastResult:b}}).catch(v=>(p.forEach(g=>g.onerror&&g.onerror(v)),Promise.reject(v)))})}function h(l,d,f){return n.query({trans:l,values:!1,query:{index:r,range:d},limit:f}).then(({result:m})=>c({type:"delete",keys:m,trans:l}).then(p=>p.numFailures>0?Promise.reject(p.failures[0]):m.length<f?{failures:[],numFailures:0,lastResult:void 0}:h(l,{...d,lower:m[m.length-1],lowerOpen:!0},f)))}}}}})};function Xi(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,i=0;s<e.keys.length&&i<t.length;++s)ee(e.keys[s],t[i])===0&&(r.push(n?Ot(e.values[s]):e.values[s]),++i);return r.length===t.length?r:null}catch{return null}}const Za={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=Xi(r.keys,r.trans._cache,r.cache==="clone");return s?S.resolve(s):n.getMany(r).then(i=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Ot(i):i},i))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function cs(t){return!("from"in t)}const Pe=function(t,e){if(!this){const n=new Pe;return t&&"d"in t&&Z(n,t),n}Z(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function Vt(t,e,n){const r=ee(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(cs(t))return Z(t,{from:e,to:n,d:1});const s=t.l,i=t.r;if(ee(n,t.from)<0)return s?Vt(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Zi(t);if(ee(e,t.to)>0)return i?Vt(i,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Zi(t);ee(e,t.from)<0&&(t.from=e,t.l=null,t.d=i?i.d+1:1),ee(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;s&&!t.l&&Bn(t,s),i&&o&&Bn(t,i)}function Bn(t,e){cs(e)||function n(r,{from:s,to:i,l:o,r:a}){Vt(r,s,i),o&&n(r,o),a&&n(r,a)}(t,e)}function eu(t,e){const n=ls(e);let r=n.next();if(r.done)return!1;let s=r.value;const i=ls(t);let o=i.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(ee(a.from,s.to)<=0&&ee(a.to,s.from)>=0)return!0;ee(s.from,a.from)<0?s=(r=n.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}function ls(t){let e=cs(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&ee(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||ee(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Zi(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const i=s==="r"?"l":"r",o={...t},a=t[s];t.from=a.from,t.to=a.to,t[s]=a[s],o[s]=a[i],t[i]=o,o.d=eo(o)}t.d=eo(t)}function eo({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}ct(Pe.prototype,{add(t){return Bn(this,t),this},addKey(t){return Vt(this,t,t),this},addKeys(t){return t.forEach(e=>Vt(this,e,e)),this},[Pr](){return ls(this)}});const tu={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new Pe(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:i}=s,{primaryKey:o}=i,{extractKey:a,outbound:u}=o,c={...s,mutate:d=>{const f=d.trans,m=f.mutatedParts||(f.mutatedParts={}),p=x=>{const _=`idb://${e}/${r}/${x}`;return m[_]||(m[_]=new Pe)},v=p(""),g=p(":dels"),{type:y}=d;let[b,k]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const E=d.trans._cache;return s.mutate(d).then(x=>{if(G(b)){y!=="delete"&&(b=x.results),v.addKeys(b);const _=Xi(b,E);_||y==="add"||g.addKeys(b),(_||k)&&function(P,w,I,K){function M(T){const j=P(T.name||"");function le(R){return R!=null?T.extractKey(R):null}const he=R=>T.multiEntry&&G(R)?R.forEach(se=>j.addKey(se)):j.addKey(R);(I||K).forEach((R,se)=>{const ye=I&&le(I[se]),ut=K&&le(K[se]);ee(ye,ut)!==0&&(ye!=null&&he(ye),ut!=null&&he(ut))})}w.indexes.forEach(M)}(p,i,_,k)}else if(b){const _={from:b.lower,to:b.upper};g.add(_),v.add(_)}else v.add(n),g.add(n),i.indexes.forEach(_=>p(_.name).add(n));return x})}},h=({query:{index:d,range:f}})=>{var m,p;return[d,new Pe((m=f.lower)!==null&&m!==void 0?m:t.MIN_KEY,(p=f.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},l={get:d=>[o,new Pe(d.key)],getMany:d=>[o,new Pe().addKeys(d.keys)],count:h,query:h,openCursor:h};return U(l).forEach(d=>{c[d]=function(f){const{subscr:m}=O;if(m){const p=k=>{const E=`idb://${e}/${r}/${k}`;return m[E]||(m[E]=new Pe)},v=p(""),g=p(":dels"),[y,b]=l[d](f);if(p(y.name||"").add(b),!y.isPrimaryKey){if(d!=="count"){const k=d==="query"&&u&&f.values&&s.query({...f,values:!1});return s[d].apply(this,arguments).then(E=>{if(d==="query"){if(u&&f.values)return k.then(({result:_})=>(v.addKeys(_),E));const x=f.values?E.result.map(a):E.result;f.values?v.addKeys(x):g.addKeys(x)}else if(d==="openCursor"){const x=E,_=f.values;return x&&Object.create(x,{key:{get:()=>(g.addKey(x.primaryKey),x.key)},primaryKey:{get(){const P=x.primaryKey;return g.addKey(P),P}},value:{get:()=>(_&&v.addKey(x.primaryKey),x.value)}})}return E})}g.add(n)}}return s[d].apply(this,arguments)}}),c}}}};let hs=class mr{constructor(e,n){this._middlewares={},this.verno=0;const r=mr.dependencies;this._options=n={addons:mr.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:F,dbReadyPromise:null,cancelOpen:F,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new S(a=>{i.dbReadyResolve=a}),i.openCanceller=new S((a,u)=>{i.cancelOpen=u}),this._state=i,this.name=e,this.on=Rt(this,"populate","blocked","versionchange","close",{ready:[Dr,F]}),this.on.ready.subscribe=pi(this.on.ready.subscribe,a=>(u,c)=>{mr.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||S.resolve().then(u),c&&a(u);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(u),c&&a(u);else{a(u);const l=this;c||a(function d(){l.on.ready.unsubscribe(u),l.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,Ft(Ra.prototype,function(a,u){this.db=o;let c=Ni,h=null;if(u)try{c=u()}catch(m){h=m}const l=a._ctx,d=l.table,f=d.hook.reading.fire;this._ctx={table:d,index:l.index,isPrimKey:!l.index||d.schema.primKey.keyPath&&l.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:l.or,valueMapper:f!==At?f:null}})),this.Table=function(a){return Ft(Ma.prototype,function(u,c,h){this.db=a,this._tx=h,this.name=u,this.schema=c,this.hook=a._allTables[u]?a._allTables[u].hook:Rt(null,{creating:[Pa,F],reading:[Ea,At],updating:[Ca,F],deleting:[Sa,F]})})}(this),this.Transaction=function(a){return Ft(za.prototype,function(u,c,h,l,d){this.db=a,this.mode=u,this.storeNames=c,this.schema=h,this.chromeTransactionDurability=l,this.idbtrans=null,this.on=Rt(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new S((f,m)=>{this._resolve=f,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var m=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):m&&this.idbtrans&&this.idbtrans.abort(),W(f)})})}(this),this.Version=function(a){return Ft(Wa.prototype,function(u){this.db=a,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return Ft(Hi.prototype,function(u,c,h){this.db=a,this._ctx={table:u,index:c===":id"?null:c,or:h};const l=a._deps.indexedDB;if(!l)throw new A.MissingAPI;this._cmp=this._ascending=l.cmp.bind(l),this._descending=(d,f)=>l.cmp(f,d),this._max=(d,f)=>l.cmp(d,f)>0?d:f,this._min=(d,f)=>l.cmp(d,f)<0?d:f,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=zt(n.IDBKeyRange),this._createTransaction=(a,u,c,h)=>new this.Transaction(a,u,c,this._options.chromeTransactionDurability,h),this._fireOnBlocked=a=>{this.on("blocked").fire(a),Mt.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(a))},this.use(Qa),this.use(Xa),this.use(tu),this.use(Za),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new A.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new A.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(Ua),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||O.letThrough||this._vip)?e():new S((n,r)=>{if(this._state.openComplete)return r(new A.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new A.DatabaseClosed);this.open().catch(F)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:n,level:r??10,name:s}),i.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return Ga(this)}_close(){const e=this._state,n=Mt.indexOf(this);if(n>=0&&Mt.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new S(r=>{e.dbReadyResolve=r}),e.openCanceller=new S((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new A.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new S((r,s)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=L(()=>{(function({indexedDB:a,IDBKeyRange:u},c){!is(a)&&c!==On&&ss(a,u).delete(c).catch(F)})(this._deps,this.name),r()}),o.onerror=ge(s),o.onblocked=this._fireOnBlocked};if(e)throw new A.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return U(this._allTables).map(e=>this._allTables[e])}transaction(){const e=Ja.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=O.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const i=e.indexOf("?")!==-1;let o,a;e=e.replace("!","").replace("?","");try{if(a=n.map(c=>{var h=c instanceof this.Table?c.name:c;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e===Ur)o=Ur;else{if(e!="rw"&&e!=Hr)throw new A.InvalidArgument("Invalid transaction mode: "+e);o=Hr}if(s){if(s.mode===Ur&&o===Hr){if(!i)throw new A.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&a.forEach(c=>{if(s&&s.storeNames.indexOf(c)===-1){if(!i)throw new A.SubTransaction("Table "+c+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(h,l)=>{l(c)}):W(c)}const u=Qi.bind(null,this,o,a,s,r);return s?s._promise(o,u,"lock"):O.trans?yt(O.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!oe(this._allTables,e))throw new A.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}};const nu=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class ru{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[nu](){return this}}function to(t,e){return U(e).forEach(n=>{Bn(t[n]||(t[n]=new Pe),e[n])}),t}function su(t){let e,n=!1;const r=new ru(s=>{const i=Sr(t);let o=!1,a={},u={};const c={get closed(){return o},unsubscribe:()=>{o=!0,Fe.storagemutated.unsubscribe(f)}};s.start&&s.start(c);let h=!1,l=!1;function d(){return U(u).some(p=>a[p]&&eu(a[p],u[p]))}const f=p=>{to(a,p),d()&&m()},m=()=>{if(h||o)return;a={};const p={},v=function(g){i&&pt();const y=()=>Te(t,{subscr:g,trans:null}),b=O.trans?yt(O.transless,y):y();return i&&b.then(ke,ke),b}(p);l||(Fe(qt,f),l=!0),h=!0,Promise.resolve(v).then(g=>{n=!0,e=g,h=!1,o||(d()?m():(a={},u=p,s.next&&s.next(g)))},g=>{h=!1,n=!1,s.error&&s.error(g),c.unsubscribe()})};return m(),c});return r.hasValue=()=>n,r.getValue=()=>e,r}let ds;try{ds={indexedDB:q.indexedDB||q.mozIndexedDB||q.webkitIndexedDB||q.msIndexedDB,IDBKeyRange:q.IDBKeyRange||q.webkitIDBKeyRange}}catch{ds={indexedDB:null,IDBKeyRange:null}}const Xe=hs;function Mn(t){let e=Se;try{Se=!0,Fe.storagemutated.fire(t)}finally{Se=e}}ct(Xe,{...mn,delete:t=>new Xe(t,{addons:[]}).delete(),exists:t=>new Xe(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return is(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==On)):ss(e,n).toCollection().primaryKeys()}(Xe.dependencies).then(t)}catch{return W(new A.MissingAPI)}},defineClass:()=>function(t){Z(this,t)},ignoreTransaction:t=>O.trans?yt(O.transless,t):t(),vip:os,async:function(t){return function(){try{var e=as(t.apply(this,arguments));return e&&typeof e.then=="function"?e:S.resolve(e)}catch(n){return W(n)}}},spawn:function(t,e,n){try{var r=as(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:S.resolve(r)}catch(s){return W(s)}},currentTransaction:{get:()=>O.trans||null},waitFor:function(t,e){const n=S.resolve(typeof t=="function"?Xe.ignoreTransaction(t):t).timeout(e||6e4);return O.trans?O.trans.waitFor(n):n},Promise:S,debug:{get:()=>me,set:t=>{_i(t,t==="dexie"?()=>!0:Fi)}},derive:lt,extend:Z,props:ct,override:pi,Events:Rt,on:Fe,liveQuery:su,extendObservabilitySet:to,getByKeyPath:we,setByKeyPath:de,delByKeyPath:function(t,e){typeof e=="string"?de(t,e,void 0):"length"in e&&[].map.call(e,function(n){de(t,n,void 0)})},shallowClone:gi,deepClone:Ot,getObjectDiff:us,cmp:ee,asap:yi,minKey:Vr,addons:[],connections:Mt,errnames:Or,dependencies:ds,semVer:Mi,version:Mi.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),Xe.maxKey=zt(Xe.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Fe(qt,t=>{if(!Se){let e;Kn?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Re,!0,!0,t)):e=new CustomEvent(Re,{detail:t}),Se=!0,dispatchEvent(e),Se=!1}}),addEventListener(Re,({detail:t})=>{Se||Mn(t)}));let Se=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Re);typeof t.unref=="function"&&t.unref(),Fe(qt,e=>{Se||t.postMessage(e)}),t.onmessage=e=>{e.data&&Mn(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Fe(qt,e=>{try{Se||(typeof localStorage<"u"&&localStorage.setItem(Re,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Re,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Re){const n=JSON.parse(e.newValue);n&&Mn(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Re&&Mn(e.changedParts)})}S.rejectionMapper=function(t,e){if(!t||t instanceof dt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!Ei[t.name])return t;var n=new Ei[t.name](e||t.message,t);return"stack"in t&&_e(n,"stack",{get:function(){return this.inner.stack}}),n},_i(me,Fi);const fs={cosine:(t,e)=>{const n=t.reduce((i,o,a)=>i+o*e[a],0),r=Math.sqrt(t.reduce((i,o)=>i+o**2,0)),s=Math.sqrt(e.reduce((i,o)=>i+o**2,0));return 1-n/(r*s)},"cosine-normalized":(t,e)=>1-t.reduce((n,r,s)=>n+r*e[s],0)};let Ut=class{constructor(e,n){B(this,"key"),B(this,"value"),B(this,"isDeleted"),this.key=e,this.value=n,this.isDeleted=!1}};class iu{constructor(){B(this,"nodesMap"),B(this,"shouldPreComputeDistance",!1),B(this,"distanceCache",new Map),this.nodesMap=new Map}async size(){return this.nodesMap.size}async has(e){return this.nodesMap.has(e)}async get(e,n){return this.nodesMap.get(e)}async set(e,n){this.nodesMap.set(e,n)}async keys(){return[...this.nodesMap.keys()]}async bulkSet(e,n){for(const[r,s]of e.entries())this.nodesMap.set(s,n[r])}async clear(){this.nodesMap=new Map}preComputeDistance(e){}}class ou{constructor(e,n,r,s=4096){B(this,"nodesMap"),B(this,"dbPromise"),B(this,"graphLayers"),B(this,"prefetchSize"),B(this,"hasSetPrefetchSize"),B(this,"_prefetchTimes",0),B(this,"shouldPreComputeDistance",!1),B(this,"distanceCache",new Map),B(this,"distanceCacheMaxSize"),this.nodesMap=new Map,this.graphLayers=e,r!==void 0?(this.prefetchSize=r,this.hasSetPrefetchSize=!0):(this.prefetchSize=8e3,this.hasSetPrefetchSize=!1),n===!0&&(this.shouldPreComputeDistance=!0),this.distanceCacheMaxSize=s;const i=new hs("mememo-index-store");i.version(1).stores({mememo:"key"});const o=i.table("mememo");this.dbPromise=o.clear().then(()=>o)}async size(){return await(await this.dbPromise).count()}async has(e){return await(await this.dbPromise).get(e)!==void 0}async get(e,n){if(this.nodesMap.has(e)||await this._prefetch(e,n),!this.nodesMap.has(e))throw Error(`The node ${e} is not in memory after pre-fetching.`);return this.nodesMap.get(e)}async set(e,n){this.hasSetPrefetchSize||this._updateAutoPrefetchSize(n.value.length),await(await this.dbPromise).put(n,e),this.nodesMap.has(e)&&this.nodesMap.set(e,n)}async keys(){return await(await this.dbPromise).toCollection().primaryKeys()}async bulkSet(e,n){!this.hasSetPrefetchSize&&n.length>0&&this._updateAutoPrefetchSize(n[0].value.length),await(await this.dbPromise).bulkPut(n);for(let r=0;r<Math.min(this.prefetchSize,e.length);r++)this.nodesMap.set(e[r],n[r])}async clear(){await(await this.dbPromise).clear()}_updateAutoPrefetchSize(e){if(!this.hasSetPrefetchSize){const n=Math.floor(625e4);this.prefetchSize=Math.floor(n/e),this.hasSetPrefetchSize=!0}}async _prefetch(e,n){this.nodesMap.clear();const r=this.graphLayers[n],s=c=>c.distance,i=new fn(s),o=new Set,a=new Set;for(i.push({key:e,distance:0}),o.add(e);i.size()>0&&a.size<this.prefetchSize;){const c=i.pop();if(c===null)break;a.add(c.key);const h=r.graph.get(c.key);if(h===void 0)throw Error(`Cannot find node with key ${c.key}`);for(const l of h.keys()){const d=h.get(l);o.has(l)||(o.add(l),i.push({key:l,distance:c.distance+d}))}}const u=await(await this.dbPromise).bulkGet([...a]);for(;u.length>0;){const c=u.pop();c!==void 0&&this.nodesMap.set(c.key,c)}this._prefetchTimes+=1}preComputeDistance(e){!this.nodesMap.has(e)||this.shouldPreComputeDistance}}let no=class{constructor(e){B(this,"graph"),this.graph=new Map,this.graph.set(e,new Map)}toJSON(){const e={};for(const[n,r]of this.graph.entries()){const s={};for(const[i,o]of r.entries())s[i]=o;e[n]=s}return e}loadJSON(e){this.graph=new Map;for(const n of Object.keys(e)){const r=e[n],s=new Map;for(const i of Object.keys(r)){const o=r[i];s.set(i,o)}this.graph.set(n,s)}}};class au{constructor({distanceFunction:e,m:n,efConstruction:r,mMax0:s,ml:i,seed:o,useIndexedDB:a,distancePrecision:u}){B(this,"distanceFunction"),B(this,"distanceFunctionType"),B(this,"_distanceFunctionCallTimes",0),B(this,"_distanceFunctionSkipTimes",0),B(this,"useDistanceCache",!1),B(this,"distancePrecision",6),B(this,"m"),B(this,"efConstruction"),B(this,"mMax0"),B(this,"ml"),B(this,"seed"),B(this,"rng"),B(this,"nodes"),B(this,"graphLayers"),B(this,"entryPointKey",null),B(this,"useIndexedDB",!0),this.m=n||16,this.efConstruction=r||100,this.mMax0=s||this.m*2,this.ml=i||1/Math.log(this.m),this.seed=o||ia()(),this.distancePrecision=u||6,this.rng=ua(this.seed);let c=fs["cosine-normalized"];this.distanceFunctionType="cosine-normalized",e===void 0?(c=fs["cosine-normalized"],this.distanceFunctionType="cosine-normalized"):typeof e=="string"?(c=fs[e],e==="cosine-normalized"?this.distanceFunctionType="cosine-normalized":e==="cosine"&&(this.distanceFunctionType="cosine")):(c=e,this.distanceFunctionType="custom"),this.useDistanceCache=!1,this.graphLayers=[],a===void 0||a===!1?(this.useIndexedDB=!1,this.nodes=new iu):(this.useIndexedDB=!0,this.nodes=new ou(this.graphLayers,this.useDistanceCache)),this.distanceFunction=(h,l,d,f)=>{if(!this.useDistanceCache||d===null||f===null)return this._distanceFunctionCallTimes+=1,ro(c(h,l),this.distancePrecision);const m=`${d}-${f}`,p=`${f}-${d}`;if(this.nodes.distanceCache.has(m))return this._distanceFunctionSkipTimes+=1,this.nodes.distanceCache.get(m);if(this.nodes.distanceCache.has(p))return this._distanceFunctionSkipTimes+=1,this.nodes.distanceCache.get(p);const v=ro(c(h,l),this.distancePrecision);return this._distanceFunctionCallTimes+=1,v}}exportIndex(){const e=this.graphLayers.map(n=>n.toJSON());return{distanceFunctionType:this.distanceFunctionType,m:this.m,efConstruction:this.efConstruction,mMax0:this.mMax0,ml:this.ml,seed:this.seed,useIndexedDB:this.useIndexedDB,useDistanceCache:this.useDistanceCache,entryPointKey:this.entryPointKey,graphLayers:e}}loadIndex(e){this.distanceFunctionType=e.distanceFunctionType,this.m=e.m,this.efConstruction=e.efConstruction,this.mMax0=e.mMax0,this.ml=e.ml,this.seed=e.seed,this.useIndexedDB=e.useIndexedDB,this.useDistanceCache=e.useDistanceCache,this.entryPointKey=e.entryPointKey,this.graphLayers=[];for(const n of e.graphLayers){const r=new no("");r.loadJSON(n),this.graphLayers.push(r)}}async insert(e,n,r){const s=r===void 0?this._getRandomLevel():r;if(await this.nodes.has(e)){const i=await this._getNodeInfo(e,s);if(i.isDeleted){i.isDeleted=!1,await this.nodes.set(e,i),await this.update(e,n);return}throw Error(`There is already a node with key ${e} in theindex. Use update() to update this node.`)}await this.nodes.set(e,new Ut(e,n)),await this._insertToGraph(e,n,s)}async bulkInsert(e,n,r){const s=await this.nodes.keys();for(const o of e)if(s.includes(o))throw Error(`There is already a node with key ${o} in theindex. Use update() to update this node.`);const i=[];for(const[o,a]of e.entries())i.push(new Ut(a,n[o]));await this.nodes.bulkSet(e,i);for(const[o,a]of e.entries())if(r===void 0){const u=this._getRandomLevel();await this._insertToGraph(a,n[o],u)}else await this._insertToGraph(a,n[o],r[o])}async insertSkipIndex(e,n){if(await this.nodes.has(e))throw Error(`There is already a node with key ${e} in the index.`);await this.nodes.set(e,new Ut(e,n))}async bulkInsertSkipIndex(e,n){const r=await this.nodes.keys();for(const i of e)if(r.includes(i))throw Error(`There is already a node with key ${i} in the index.`);const s=[];for(const[i,o]of e.entries())s.push(new Ut(o,n[i]));await this.nodes.bulkSet(e,s)}async _insertToGraph(e,n,r){if(this.entryPointKey!==null){this.nodes.shouldPreComputeDistance&&this.nodes.preComputeDistance(e);const s=await this._getNodeInfo(this.entryPointKey,this.graphLayers.length-1);let i=this.distanceFunction(n,s.value,e,s.key),o=this.entryPointKey;for(let c=this.graphLayers.length-1;c>=r+1;c--){const h=await this._searchLayerEF1(e,n,o,i,c);i=h.minDistance,o=h.minNodeKey}let a=[{key:o,distance:i}];const u=Math.min(this.graphLayers.length-1,r);for(let c=u;c>=0;c--){const h=c===0?this.mMax0:this.m;a=await this._searchLayer(e,n,a,c,this.efConstruction);const l=await this._selectNeighborsHeuristic(a,h,c),d=new Map;for(const f of l)d.set(f.key,f.distance);this.graphLayers[c].graph.set(e,d);for(const f of l){const m=this.graphLayers[c].graph.get(f.key);if(m===void 0)throw Error(`Can't find neighbor node ${f.key}`);const p=[];for(const[y,b]of m.entries()){const k={key:y,distance:b};p.push(k)}p.push({key:e,distance:f.distance});const v=await this._selectNeighborsHeuristic(p,h,c),g=new Map;for(const y of v)g.set(y.key,y.distance);this.graphLayers[c].graph.set(f.key,g)}}}for(let s=this.graphLayers.length;s<r+1;s++)this.graphLayers.push(new no(e)),this.entryPointKey=e}async update(e,n){if(!await this.nodes.has(e))throw Error(`The node with key ${e} does not exist. Use insert() to add new node.`);if(await this.nodes.set(e,new Ut(e,n)),!(this.entryPointKey===e&&await this.nodes.size()===1)){for(let r=0;r<this.graphLayers.length;r++){const s=this.graphLayers[r],i=r===0?this.mMax0:this.m;if(!s.graph.has(e))break;const o=s.graph.get(e),a=new Set([e]);for(const c of o.keys()){a.add(c);const h=s.graph.get(c);if(h===void 0)throw Error(`Can't find node with key ${c}`);for(const l of h.keys())a.add(l)}const u=c=>c.distance;for(const c of o.keys()){const h=new di(u),l=await this._getNodeInfo(c,r);for(const p of a){if(p===c)continue;const v=await this._getNodeInfo(p,r),g=this.distanceFunction(l.value,v.value,l.key,v.key);h.size()<this.efConstruction?h.push({key:p,distance:g}):g<h.top().distance&&(h.pop(),h.push({key:p,distance:g}))}const d=h.toArray(),f=await this._selectNeighborsHeuristic(d,i,r),m=new Map;for(const p of f)m.set(p.key,p.distance);s.graph.set(c,m)}}await this._reIndexNode(e,n)}}async markDeleted(e){if(!await this.nodes.has(e))throw Error(`Node with key ${e} does not exist.`);if(this.entryPointKey===e){let r=null;for(let s=this.graphLayers.length-1;s>=0;s--){for(const i of this.graphLayers[s].graph.keys()){const o=await this._getNodeInfo(i,s);if(i!==e&&!o.isDeleted){r=i;break}}if(r!==null)break;this.graphLayers.splice(s,1)}if(r===null){await this.clear();return}this.entryPointKey=r}const n=await this._getNodeInfo(e,0);n.isDeleted=!0,await this.nodes.set(e,n)}async unMarkDeleted(e){const n=await this._getNodeInfo(e,0);n.isDeleted=!1,await this.nodes.set(e,n)}async clear(){this.graphLayers=[],await this.nodes.clear()}async query(e,n=void 0,r=this.efConstruction){if(this.entryPointKey===null)throw Error("Index is not initialized yet");let s=this.entryPointKey;const i=await this._getNodeInfo(s,this.graphLayers.length-1);let o=this.distanceFunction(i.value,e,null,null);for(let d=this.graphLayers.length-1;d>=1;d--){const f=await this._searchLayerEF1(null,e,s,o,d,!1);s=f.minNodeKey,o=f.minDistance}const a=[{key:s,distance:o}],u=await this._searchLayer(null,e,a,0,r,!1);u.sort((d,f)=>d.distance-f.distance);const c=n===void 0?u:u.slice(0,n),h=[],l=[];for(const d of c)h.push(d.key),l.push(d.distance);return{keys:h,distances:l}}async _reIndexNode(e,n){if(this.entryPointKey===null)throw Error("entryPointKey is null");let r=this.entryPointKey;const s=await this._getNodeInfo(r,this.graphLayers.length-1);let i=this.distanceFunction(s.value,n,s.key,e),o=[{key:r,distance:i}];for(let a=this.graphLayers.length-1;a>=0;a--){const u=this.graphLayers[a];if(u.graph.has(e)){const c=a===0?this.mMax0:this.m;o=await this._searchLayer(e,n,o,a,this.efConstruction+1),o=o.filter(d=>d.key!==e);const h=await this._selectNeighborsHeuristic(o,c,a),l=new Map;for(const d of h)l.set(d.key,d.distance);u.graph.set(e,l)}else{const c=await this._searchLayerEF1(e,n,r,i,a);r=c.minNodeKey,i=c.minDistance}}}async _searchLayerEF1(e,n,r,s,i,o=!0){const a=this.graphLayers[i],u=f=>f.distance,c=new fn(u);c.push({key:r,distance:s});let h=r,l=s;const d=new Set;for(;c.size()>0;){const f=c.pop();if(f.distance>l)break;const m=a.graph.get(f.key);if(m===void 0)throw Error(`Cannot find node with key ${f.key})}`);for(const p of m.keys())if(!d.has(p)){d.add(p);const v=await this._getNodeInfo(p,i),g=this.distanceFunction(v.value,n,v.key,e);g<l&&((!v.isDeleted||o)&&(l=g,h=p),c.push({key:p,distance:g}))}}return{minNodeKey:h,minDistance:l}}async _searchLayer(e,n,r,s,i,o=!0){const a=this.graphLayers[s],u=d=>d.distance,c=new fn(u),h=new di(u),l=new Set;for(const d of r)c.push(d),h.push(d),l.add(d.key);for(;c.size()>0;){const d=c.pop(),f=h.root();if(d.distance>f.distance)break;const m=a.graph.get(d.key);if(m===void 0)throw Error(`Cannot find node with key ${d.key}`);for(const p of m.keys())if(!l.has(p)){l.add(p);const v=await this._getNodeInfo(p,s),g=this.distanceFunction(n,v.value,e,v.key),y=h.root();(g<y.distance||h.size()<i)&&((!v.isDeleted||o)&&h.push({key:p,distance:g}),c.push({key:p,distance:g}),h.size()>i&&h.pop())}}return h.toArray()}async _selectNeighborsHeuristic(e,n,r){if(e.length<n)return e;const s=a=>a.distance,i=new fn(s);for(const a of e)i.insert(a);const o=[];for(;i.size()>0;){if(o.length>=n)return o;const a=i.pop();let u=!0;for(const c of o){const h=await this._getNodeInfo(a.key,r),l=await this._getNodeInfo(c.key,r);if(this.distanceFunction(h.value,l.value,a.key,l.key)<a.distance){u=!1;break}}u&&o.push(a)}return o}_getRandomLevel(){return Math.floor(-Math.log(this.rng())*this.ml)}async _getNodeInfo(e,n){const r=await this.nodes.get(e,n);if(r===void 0)throw Error(`Can't find node with key ${e}`);return r}}const ro=(t,e)=>Math.round((t+Number.EPSILON)*10**e)/10**e;/**
 * @author Jay Wang
 * @email jay@zijie.wang
 * @license MIT
 */const uu=t=>{let e="";return new TransformStream({transform:(r,s)=>{e+=r;const i=e.split(t);i.slice(0,-1).forEach(o=>s.enqueue(o)),e=i[i.length-1]},flush:r=>{e&&r.enqueue(e)}})},cu=()=>new TransformStream({transform:(e,n)=>{n.enqueue(JSON.parse(e))}}),ps=new Set,so=(t,e)=>{e&&(ps.has(t)?(console.timeEnd(t),ps.delete(t)):(console.time(t),ps.add(t)))};function ys(t,e){return typeof t>"u"?e:t}function io(t){const e=Array(t);for(let n=0;n<t;n++)e[n]=ie();return e}function lu(t){return Object.keys(t)}function ie(){return Object.create(null)}function hu(t){return[].concat.apply([],t)}function du(t,e){return e.length-t.length}function fu(t){return t.constructor===Array}function Rn(t){return typeof t=="string"}function ms(t){return typeof t=="object"}function pu(t){return typeof t=="function"}function yu(t,e,n,r){if(t&&(e&&(t=gs(t,e)),this.matcher&&(t=gs(t,this.matcher)),this.stemmer&&1<t.length&&(t=gs(t,this.stemmer)),r&&1<t.length&&(t=vu(t)),n||n==="")){const s=t.split(n);return this.filter?bu(s,this.filter):s}return t}const mu=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function gu(t){const e=ie();for(let n=0,r=t.length;n<r;n++)e[t[n]]=1;return e}function oo(t,e){const n=lu(t),r=n.length,s=[];let i="",o=0;for(let a,u,c=0;c<r;c++)a=n[c],u=t[a],u?(s[o++]=ao(e?"(?!\\b)"+a+"(\\b|_)":a),s[o++]=u):i+=(i?"|":"")+a;return i&&(s[o++]=ao(e?"(?!\\b)("+i+")(\\b|_)":"("+i+")"),s[o]=""),s}function gs(t,e){for(let n=0,r=e.length;n<r&&(t=t.replace(e[n],e[n+1]),!!t);n+=2);return t}function ao(t){return new RegExp(t,"g")}function vu(t){let e="",n="";for(let r,s=0,i=t.length;s<i;s++)(r=t[s])!==n&&(e+=n=r);return e}function bu(t,e){const n=t.length,r=[];for(let s=0,i=0;s<n;s++){const o=t[s];o&&!e[o]&&(r[i++]=o)}return r}function _u(t){return yu.call(this,(""+t).toLowerCase(),!1,mu,!1)}const wu={},xu={};function ku(t){Ht(t,"add"),Ht(t,"append"),Ht(t,"search"),Ht(t,"update"),Ht(t,"remove")}function Ht(t,e){t[e+"Async"]=function(){const n=this,r=arguments,s=r[r.length-1];let i;pu(s)&&(i=s,delete r[r.length-1]);const o=new Promise(function(a){setTimeout(function(){n.async=!0;const u=n[e].apply(n,r);n.async=!1,a(u)})});return i?(o.then(i),this):o}}function Eu(t,e,n,r){const s=t.length;let i,o,a=[],u=0;r&&(r=[]);for(let c=s-1;0<=c;c--){const h=t[c],l=h.length,d=ie();let f=!i;for(let m=0;m<l;m++){const p=h[m],v=p.length;if(v)for(let g,y,b=0;b<v;b++)if(y=p[b],i){if(i[y]){if(!c){if(n)n--;else if(a[u++]=y,u===e)return a}(c||r)&&(d[y]=1),f=!0}if(r&&(g=(o[y]||0)+1,o[y]=g,g<s)){const k=r[g-2]||(r[g-2]=[]);k[k.length]=y}}else d[y]=1}if(r)i||(o=d);else if(!f)return[];i=d}if(r)for(let c,h,l=r.length-1;0<=l;l--){c=r[l],h=c.length;for(let d,f=0;f<h;f++)if(d=c[f],!i[d]){if(n)n--;else if(a[u++]=d,u===e)return a;i[d]=1}}return a}function Fn(t){this.limit=t!==!0&&t,this.cache=ie(),this.queue=[]}function Pu(t,e,n){ms(t)&&(t=t.query);let r=this.cache.get(t);return r||(r=this.search(t,e,n),this.cache.set(t,r)),r}Fn.prototype.set=function(t,e){if(!this.cache[t]){let n=this.queue.length;n===this.limit?delete this.cache[this.queue[n-1]]:n++;for(let r=n-1;0<r;r--)this.queue[r]=this.queue[r-1];this.queue[0]=t}this.cache[t]=e},Fn.prototype.get=function(t){const e=this.cache[t];if(this.limit&&e){const n=this.queue.indexOf(t);if(n){const r=this.queue[n-1];this.queue[n-1]=this.queue[n],this.queue[n]=r}}return e},Fn.prototype.del=function(t){for(let e,n,r=0;r<this.queue.length;r++)n=this.queue[r],e=this.cache[n],e.includes(t)&&(this.queue.splice(r--,1),delete this.cache[n])};const Su={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function Cu(t){if(Rn(t))t=Su[t];else{const e=t.preset;e&&(t=Object.assign({},e[e],t))}return t}function Ku(t,e,n,r,s,i){setTimeout(function(){const o=t(n,JSON.stringify(i));o&&o.then?o.then(function(){e.export(t,e,n,r,s+1)}):e.export(t,e,n,r,s+1)})}function Ou(t,e,n,r,s){let i,o;switch(s||(s=0)){case 0:if(i="reg",this.fastupdate)for(let a in o=ie(),this.register)o[a]=1;else o=this.register;break;case 1:i="cfg",o={doc:0,opt:this.optimize?1:0};break;case 2:i="map",o=this.map;break;case 3:i="ctx",o=this.ctx;break;default:return}return Ku(t,e||this,n?n+"."+i:i,r,s,o),!0}function Du(t,e){e&&(Rn(e)&&(e=JSON.parse(e)),t==="cfg"?this.optimize=!!e.opt:t==="reg"?(this.fastupdate=!1,this.register=e):t==="map"?this.map=e:t==="ctx"&&(this.ctx=e))}function te(t,e){if(!(this instanceof te))return new te(t);let n,r,s;t?(t=Cu(t),n=t.charset,r=t.lang,Rn(n)&&(n.indexOf(":")===-1&&(n+=":default"),n=xu[n]),Rn(r)&&(r=wu[r])):t={};let i,o,a=t.context||{};this.encode=t.encode||n&&n.encode||_u,this.register=e||ie(),this.resolution=i=t.resolution||9,this.tokenize=s=n&&n.tokenize||t.tokenize||"strict",this.depth=s==="strict"&&a.depth,this.bidirectional=ys(a.bidirectional,!0),this.optimize=o=ys(t.optimize,!0),this.fastupdate=ys(t.fastupdate,!0),this.minlength=t.minlength||1,this.boost=t.boost,this.map=o?io(i):ie(),this.resolution_ctx=i=a.resolution||1,this.ctx=o?io(i):ie(),this.rtl=n&&n.rtl||t.rtl,this.matcher=(s=t.matcher||r&&r.matcher)&&oo(s,!1),this.stemmer=(s=t.stemmer||r&&r.stemmer)&&oo(s,!0),this.filter=(s=t.filter||r&&r.filter)&&gu(s),this.cache=(s=t.cache)&&new Fn(s)}te.prototype.append=function(t,e){return this.add(t,e,!0)},te.prototype.add=function(t,e,n,r){if(e&&(t||t===0)){if(!r&&!n&&this.register[t])return this.update(t,e);e=this.encode(""+e);const s=e.length;if(s){const i=ie(),o=ie(),a=this.depth,u=this.resolution;for(let c=0;c<s;c++){let h=e[this.rtl?s-1-c:c],l=h.length;if(h&&l>=this.minlength&&(a||!o[h])){let d=Nn(u,s,c),f="";switch(this.tokenize){case"full":if(2<l){for(let m=0;m<l;m++)for(let p=l;p>m;p--)if(p-m>=this.minlength){const v=Nn(u,s,c,l,m);f=h.substring(m,p),this.push_index(o,f,v,t,n)}break}case"reverse":if(1<l){for(let m=l-1;0<m;m--)if(f=h[m]+f,f.length>=this.minlength){const p=Nn(u,s,c,l,m);this.push_index(o,f,p,t,n)}f=""}case"forward":if(1<l){for(let m=0;m<l;m++)f+=h[m],f.length>=this.minlength&&this.push_index(o,f,d,t,n);break}default:if(this.boost&&(d=Math.min(0|d/this.boost(e,h,c),u-1)),this.push_index(o,h,d,t,n),a&&1<s&&c<s-1){const m=ie(),p=this.resolution_ctx,v=h,g=Math.min(a+1,s-c);m[v]=1;for(let y=1;y<g;y++)if(h=e[this.rtl?s-1-c-y:c+y],h&&h.length>=this.minlength&&!m[h]){m[h]=1;const b=Nn(p+(s/2>p?0:1),s,c,g-1,y-1),k=this.bidirectional&&h>v;this.push_index(i,k?v:h,b,t,n,k?h:v)}}}}}this.fastupdate||(this.register[t]=1)}}return this};function Nn(t,e,n,r,s){return n&&1<t?e+(r||0)<=t?n+(s||0):0|(t-1)/(e+(r||0))*(n+(s||0))+1:0}te.prototype.push_index=function(t,e,n,r,s,i){let o=i?this.ctx:this.map;if((!t[e]||i&&!t[e][i])&&(this.optimize&&(o=o[n]),i?(t=t[e]||(t[e]=ie()),t[i]=1,o=o[i]||(o[i]=ie())):t[e]=1,o=o[e]||(o[e]=[]),this.optimize||(o=o[n]||(o[n]=[])),(!s||!o.includes(r))&&(o[o.length]=r,this.fastupdate))){const a=this.register[r]||(this.register[r]=[]);a[a.length]=o}},te.prototype.search=function(t,e,n){n||(!e&&ms(t)?(n=t,t=n.query):ms(e)&&(n=e));let r,s,i,o=[],a=0;if(n&&(t=n.query||t,e=n.limit,a=n.offset||0,s=n.context,i=n.suggest),t&&(t=this.encode(""+t),r=t.length,1<r)){const l=ie(),d=[];for(let f,m=0,p=0;m<r;m++)if(f=t[m],f&&f.length>=this.minlength&&!l[f]){if(!this.optimize&&!i&&!this.map[f])return o;d[p++]=f,l[f]=1}t=d,r=t.length}if(!r)return o;e||(e=100);let u,c=this.depth&&1<r&&s!==!1,h=0;c?(u=t[0],h=1):1<r&&t.sort(du);for(let l,d;h<r;h++){if(d=t[h],c?(l=this.add_result(o,i,e,a,r===2,d,u),(!i||l!==!1||!o.length)&&(u=d)):l=this.add_result(o,i,e,a,r===1,d),l)return l;if(i&&h==r-1){let f=o.length;if(!f){if(c){c=0,h=-1;continue}return o}if(f===1)return uo(o[0],e,a)}}return Eu(o,e,a,i)},te.prototype.add_result=function(t,e,n,r,s,i,o){let a=[],u=o?this.ctx:this.map;if(this.optimize||(u=co(u,i,o,this.bidirectional)),u){let c=0;const h=Math.min(u.length,o?this.resolution_ctx:this.resolution);for(let l,d,f=0,m=0;f<h&&(l=u[f],!(l&&(this.optimize&&(l=co(l,i,o,this.bidirectional)),r&&l&&s&&(d=l.length,d<=r?(r-=d,l=null):(l=l.slice(r),r=0)),l&&(a[c++]=l,s&&(m+=l.length,m>=n)))));f++);if(c)return s?uo(a,n,0):void(t[t.length]=a)}return!e&&a};function uo(t,e,n){return t=t.length===1?t[0]:hu(t),n||t.length>e?t.slice(n,n+e):t}function co(t,e,n,r){if(n){const s=r&&e>n;t=t[s?e:n],t=t&&t[s?n:e]}else t=t[e];return t}te.prototype.contain=function(t){return!!this.register[t]},te.prototype.update=function(t,e){return this.remove(t).add(t,e)},te.prototype.remove=function(t,e){const n=this.register[t];if(n){if(this.fastupdate)for(let r,s=0;s<n.length;s++)r=n[s],r.splice(r.indexOf(t),1);else qn(this.map,t,this.resolution,this.optimize),this.depth&&qn(this.ctx,t,this.resolution_ctx,this.optimize);e||delete this.register[t],this.cache&&this.cache.del(t)}return this};function qn(t,e,n,r,s){let i=0;if(fu(t))if(s){const o=t.indexOf(e);o===-1?i++:1<t.length&&(t.splice(o,1),i++)}else{s=Math.min(t.length,n);for(let o,a=0;a<s;a++)o=t[a],o&&(i=qn(o,e,n,r,s),!r&&!i&&delete t[a])}else for(let o in t)i=qn(t[o],e,n,r,s),i||delete t[o];return i}te.prototype.searchCache=Pu,te.prototype.export=Ou,te.prototype.import=Du,ku(te.prototype);const z=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,H=Object.keys,Q=Array.isArray;function ne(t,e){return typeof e!="object"||H(e).forEach(function(n){t[n]=e[n]}),t}typeof Promise>"u"||z.Promise||(z.Promise=Promise);const Wt=Object.getPrototypeOf,Au={}.hasOwnProperty;function ue(t,e){return Au.call(t,e)}function vt(t,e){typeof e=="function"&&(e=e(Wt(t))),(typeof Reflect>"u"?H:Reflect.ownKeys)(e).forEach(n=>{Ce(t,n,e[n])})}const lo=Object.defineProperty;function Ce(t,e,n,r){lo(t,e,ne(n&&ue(n,"get")&&typeof n.get=="function"?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function bt(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Ce(t.prototype,"constructor",t),{extend:vt.bind(null,t.prototype)}}}}const $u=Object.getOwnPropertyDescriptor;function vs(t,e){let n;return $u(t,e)||(n=Wt(t))&&vs(n,e)}const Iu=[].slice;function zn(t,e,n){return Iu.call(t,e,n)}function ho(t,e){return e(t)}function Yt(t){if(!t)throw new Error("Assertion Failed")}function fo(t){z.setImmediate?setImmediate(t):setTimeout(t,0)}function po(t,e){return t.reduce((n,r,s)=>{var i=e(r,s);return i&&(n[i[0]]=i[1]),n},{})}function Ke(t,e){if(ue(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var n=[],r=0,s=e.length;r<s;++r){var i=Ke(t,e[r]);n.push(i)}return n}var o=e.indexOf(".");if(o!==-1){var a=t[e.substr(0,o)];return a===void 0?void 0:Ke(a,e.substr(o+1))}}function fe(t,e,n){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){Yt(typeof n!="string"&&"length"in n);for(var r=0,s=e.length;r<s;++r)fe(t,e[r],n[r])}else{var i=e.indexOf(".");if(i!==-1){var o=e.substr(0,i),a=e.substr(i+1);if(a==="")n===void 0?Q(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=n;else{var u=t[o];u&&ue(t,o)||(u=t[o]={}),fe(u,a,n)}}else n===void 0?Q(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function yo(t){var e={};for(var n in t)ue(t,n)&&(e[n]=t[n]);return e}const ju=[].concat;function mo(t){return ju.apply([],t)}const go="Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(mo([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>z[t]),Tu=go.map(t=>z[t]);po(go,t=>[t,!0]);let Ne=null;function Gt(t){Ne=typeof WeakMap<"u"&&new WeakMap;const e=bs(t);return Ne=null,e}function bs(t){if(!t||typeof t!="object")return t;let e=Ne&&Ne.get(t);if(e)return e;if(Q(t)){e=[],Ne&&Ne.set(t,e);for(var n=0,r=t.length;n<r;++n)e.push(bs(t[n]))}else if(Tu.indexOf(t.constructor)>=0)e=t;else{const i=Wt(t);for(var s in e=i===Object.prototype?{}:Object.create(i),Ne&&Ne.set(t,e),t)ue(t,s)&&(e[s]=bs(t[s]))}return e}const{toString:Bu}={};function _s(t){return Bu.call(t).slice(8,-1)}const ws=typeof Symbol<"u"?Symbol.iterator:"@@iterator",Mu=typeof ws=="symbol"?function(t){var e;return t!=null&&(e=t[ws])&&e.apply(t)}:function(){return null},_t={};function Oe(t){var e,n,r,s;if(arguments.length===1){if(Q(t))return t.slice();if(this===_t&&typeof t=="string")return[t];if(s=Mu(t)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}const xs=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var ve=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function vo(t,e){ve=t,bo=e}var bo=()=>!0;const Ru=!new Error("").stack;function Ze(){if(Ru)try{throw Ze.arguments,new Error}catch(t){return t}return new Error}function ks(t,e){var n=t.stack;return n?(e=e||0,n.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),n.split(`
`).slice(e).filter(bo).map(r=>`
`+r).join("")):""}var _o=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Es=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(_o),Fu={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function wt(t,e){this._e=Ze(),this.name=t,this.message=e}function wo(t,e){return t+". Errors: "+Object.keys(e).map(n=>e[n].toString()).filter((n,r,s)=>s.indexOf(n)===r).join(`
`)}function Ln(t,e,n,r){this._e=Ze(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=wo(t,e)}function Jt(t,e){this._e=Ze(),this.name="BulkError",this.failures=Object.keys(e).map(n=>e[n]),this.failuresByPos=e,this.message=wo(t,e)}bt(wt).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+ks(this._e,2))}},toString:function(){return this.name+": "+this.message}}),bt(Ln).from(wt),bt(Jt).from(wt);var Ps=Es.reduce((t,e)=>(t[e]=e+"Error",t),{});const Nu=wt;var $=Es.reduce((t,e)=>{var n=e+"Error";function r(s,i){this._e=Ze(),this.name=n,s?typeof s=="string"?(this.message=`${s}${i?`
 `+i:""}`,this.inner=i||null):typeof s=="object"&&(this.message=`${s.name} ${s.message}`,this.inner=s):(this.message=Fu[e]||n,this.inner=null)}return bt(r).from(Nu),t[e]=r,t},{});$.Syntax=SyntaxError,$.Type=TypeError,$.Range=RangeError;var xo=_o.reduce((t,e)=>(t[e+"Error"]=$[e],t),{}),Vn=Es.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=$[e]),t),{});function N(){}function Qt(t){return t}function qu(t,e){return t==null||t===Qt?e:function(n){return e(t(n))}}function et(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function zu(t,e){return t===N?e:function(){var n=t.apply(this,arguments);n!==void 0&&(arguments[0]=n);var r=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var i=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?et(r,this.onsuccess):r),s&&(this.onerror=this.onerror?et(s,this.onerror):s),i!==void 0?i:n}}function Lu(t,e){return t===N?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?et(n,this.onsuccess):n),r&&(this.onerror=this.onerror?et(r,this.onerror):r)}}function Vu(t,e){return t===N?e:function(n){var r=t.apply(this,arguments);ne(n,r);var s=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return s&&(this.onsuccess=this.onsuccess?et(s,this.onsuccess):s),i&&(this.onerror=this.onerror?et(i,this.onerror):i),r===void 0?o===void 0?void 0:o:ne(r,o)}}function Uu(t,e){return t===N?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Ss(t,e){return t===N?e:function(){var n=t.apply(this,arguments);if(n&&typeof n.then=="function"){for(var r=this,s=arguments.length,i=new Array(s);s--;)i[s]=arguments[s];return n.then(function(){return e.apply(r,i)})}return e.apply(this,arguments)}}Vn.ModifyError=Ln,Vn.DexieError=wt,Vn.BulkError=Jt;var Xt={};const ko=100,[Cs,Un,Ks]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,Wt(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,Wt(e),t]})(),Eo=Un&&Un.then,Hn=Cs&&Cs.constructor,Os=!!Ks;var Ds=!1,Hu=Ks?()=>{Ks.then(Jn)}:z.setImmediate?setImmediate.bind(null,Jn):z.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{Jn(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(Jn,0)},Zt=function(t,e){en.push([t,e]),Wn&&(Hu(),Wn=!1)},As=!0,Wn=!0,tt=[],Yn=[],$s=null,Is=Qt,xt={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:jo,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{jo(t[0],t[1])}catch{}})}},D=xt,en=[],nt=0,Gn=[];function C(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=N,this._lib=!1;var e=this._PSD=D;if(ve&&(this._stackHolder=Ze(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==Xt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&Ts(this,this._value))}this._state=null,this._value=null,++e.ref,So(this,t)}const js={get:function(){var t=D,e=Zn;function n(r,s){var i=!t.global&&(t!==D||e!==Zn);const o=i&&!De();var a=new C((u,c)=>{Bs(this,new Po(tr(r,t,i,o),tr(s,t,i,o),u,c,t))});return ve&&Oo(a,this),a}return n.prototype=Xt,n},set:function(t){Ce(this,"then",t&&t.prototype===Xt?js:{get:function(){return t},set:js.set})}};function Po(t,e,n,r,s){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=n,this.reject=r,this.psd=s}function So(t,e){try{e(n=>{if(t._state===null){if(n===t)throw new TypeError("A promise cannot be resolved with itself.");var r=t._lib&&tn();n&&typeof n.then=="function"?So(t,(s,i)=>{n instanceof C?n._then(s,i):n.then(s,i)}):(t._state=!0,t._value=n,Co(t)),r&&nn()}},Ts.bind(null,t))}catch(n){Ts(t,n)}}function Ts(t,e){if(Yn.push(e),t._state===null){var n=t._lib&&tn();e=Is(e),t._state=!1,t._value=e,ve&&e!==null&&typeof e=="object"&&!e._promise&&function(r,s,i){try{r.apply(null,i)}catch(o){s&&s(o)}}(()=>{var r=vs(e,"stack");e._promise=t,Ce(e,"stack",{get:()=>Ds?r&&(r.get?r.get.apply(e):r.value):t.stack})}),function(r){tt.some(s=>s._value===r._value)||tt.push(r)}(t),Co(t),n&&nn()}}function Co(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Bs(t,e[n]);var s=t._PSD;--s.ref||s.finalize(),nt===0&&(++nt,Zt(()=>{--nt==0&&Ms()},[]))}function Bs(t,e){if(t._state!==null){var n=t._state?e.onFulfilled:e.onRejected;if(n===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++nt,Zt(Wu,[n,t,e])}else t._listeners.push(e)}function Wu(t,e,n){try{$s=e;var r,s=e._value;e._state?r=t(s):(Yn.length&&(Yn=[]),r=t(s),Yn.indexOf(s)===-1&&function(i){for(var o=tt.length;o;)if(tt[--o]._value===i._value)return void tt.splice(o,1)}(e)),n.resolve(r)}catch(i){n.reject(i)}finally{$s=null,--nt==0&&Ms(),--n.psd.ref||n.psd.finalize()}}function Ko(t,e,n){if(e.length===n)return e;var r="";if(t._state===!1){var s,i,o=t._value;o!=null?(s=o.name||"Error",i=o.message||o,r=ks(o,0)):(s=o,i=""),e.push(s+(i?": "+i:"")+r)}return ve&&((r=ks(t._stackHolder,2))&&e.indexOf(r)===-1&&e.push(r),t._prev&&Ko(t._prev,e,n)),e}function Oo(t,e){var n=e?e._numPrev+1:0;n<100&&(t._prev=e,t._numPrev=n)}function Jn(){tn()&&nn()}function tn(){var t=As;return As=!1,Wn=!1,t}function nn(){var t,e,n;do for(;en.length>0;)for(t=en,en=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}while(en.length>0);As=!0,Wn=!0}function Ms(){var t=tt;tt=[],t.forEach(r=>{r._PSD.onunhandled.call(null,r._value,r)});for(var e=Gn.slice(0),n=e.length;n;)e[--n]()}function Qn(t){return new C(Xt,!1,t)}function V(t,e){var n=D;return function(){var r=tn(),s=D;try{return ze(n,!0),t.apply(this,arguments)}catch(i){e&&e(i)}finally{ze(s,!1),r&&nn()}}}vt(C.prototype,{then:js,_then:function(t,e){Bs(this,new Po(null,null,t,e,D))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],n=arguments[1];return typeof e=="function"?this.then(null,r=>r instanceof e?n(r):Qn(r)):this.then(null,r=>r&&r.name===e?n(r):Qn(r))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),Qn(e)))},stack:{get:function(){if(this._stack)return this._stack;try{Ds=!0;var t=Ko(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{Ds=!1}}},timeout:function(t,e){return t<1/0?new C((n,r)=>{var s=setTimeout(()=>r(new $.Timeout(e)),t);this.then(n,r).finally(clearTimeout.bind(null,s))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Ce(C.prototype,Symbol.toStringTag,"Dexie.Promise"),xt.env=Do(),vt(C,{all:function(){var t=Oe.apply(null,arguments).map(er);return new C(function(e,n){t.length===0&&e([]);var r=t.length;t.forEach((s,i)=>C.resolve(s).then(o=>{t[i]=o,--r||e(t)},n))})},resolve:t=>{if(t instanceof C)return t;if(t&&typeof t.then=="function")return new C((n,r)=>{t.then(n,r)});var e=new C(Xt,!0,t);return Oo(e,$s),e},reject:Qn,race:function(){var t=Oe.apply(null,arguments).map(er);return new C((e,n)=>{t.map(r=>C.resolve(r).then(e,n))})},PSD:{get:()=>D,set:t=>D=t},totalEchoes:{get:()=>Zn},newPSD:qe,usePSD:Et,scheduler:{get:()=>Zt,set:t=>{Zt=t}},rejectionMapper:{get:()=>Is,set:t=>{Is=t}},follow:(t,e)=>new C((n,r)=>qe((s,i)=>{var o=D;o.unhandleds=[],o.onunhandled=i,o.finalize=et(function(){(function(a){function u(){a(),Gn.splice(Gn.indexOf(u),1)}Gn.push(u),++nt,Zt(()=>{--nt==0&&Ms()},[])})(()=>{this.unhandleds.length===0?s():i(this.unhandleds[0])})},o.finalize),t()},e,n,r))}),Hn&&(Hn.allSettled&&Ce(C,"allSettled",function(){const t=Oe.apply(null,arguments).map(er);return new C(e=>{t.length===0&&e([]);let n=t.length;const r=new Array(n);t.forEach((s,i)=>C.resolve(s).then(o=>r[i]={status:"fulfilled",value:o},o=>r[i]={status:"rejected",reason:o}).then(()=>--n||e(r)))})}),Hn.any&&typeof AggregateError<"u"&&Ce(C,"any",function(){const t=Oe.apply(null,arguments).map(er);return new C((e,n)=>{t.length===0&&n(new AggregateError([]));let r=t.length;const s=new Array(r);t.forEach((i,o)=>C.resolve(i).then(a=>e(a),a=>{s[o]=a,--r||n(new AggregateError(s))}))})}));const X={awaits:0,echoes:0,id:0};var Yu=0,Xn=[],Rs=0,Zn=0,Gu=0;function qe(t,e,n,r){var s=D,i=Object.create(s);i.parent=s,i.ref=0,i.global=!1,i.id=++Gu;var o=xt.env;i.env=Os?{Promise:C,PromiseProp:{value:C,configurable:!0,writable:!0},all:C.all,race:C.race,allSettled:C.allSettled,any:C.any,resolve:C.resolve,reject:C.reject,nthen:$o(o.nthen,i),gthen:$o(o.gthen,i)}:{},e&&ne(i,e),++s.ref,i.finalize=function(){--this.parent.ref||this.parent.finalize()};var a=Et(i,t,n,r);return i.ref===0&&i.finalize(),a}function kt(){return X.id||(X.id=++Yu),++X.awaits,X.echoes+=ko,X.id}function De(){return!!X.awaits&&(--X.awaits==0&&(X.id=0),X.echoes=X.awaits*ko,!0)}function er(t){return X.echoes&&t&&t.constructor===Hn?(kt(),t.then(e=>(De(),e),e=>(De(),Y(e)))):t}function Ju(t){++Zn,X.echoes&&--X.echoes!=0||(X.echoes=X.id=0),Xn.push(D),ze(t,!0)}function Qu(){var t=Xn[Xn.length-1];Xn.pop(),ze(t,!1)}function ze(t,e){var n=D;if((e?!X.echoes||Rs++&&t===D:!Rs||--Rs&&t===D)||Ao(e?Ju.bind(null,t):Qu),t!==D&&(D=t,n===xt&&(xt.env=Do()),Os)){var r=xt.env.Promise,s=t.env;Un.then=s.nthen,r.prototype.then=s.gthen,(n.global||t.global)&&(Object.defineProperty(z,"Promise",s.PromiseProp),r.all=s.all,r.race=s.race,r.resolve=s.resolve,r.reject=s.reject,s.allSettled&&(r.allSettled=s.allSettled),s.any&&(r.any=s.any))}}function Do(){var t=z.Promise;return Os?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(z,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:Un.then,gthen:t.prototype.then}:{}}function Et(t,e,n,r,s){var i=D;try{return ze(t,!0),e(n,r,s)}finally{ze(i,!1)}}function Ao(t){Eo.call(Cs,t)}function tr(t,e,n,r){return typeof t!="function"?t:function(){var s=D;n&&kt(),ze(e,!0);try{return t.apply(this,arguments)}finally{ze(s,!1),r&&Ao(De)}}}function $o(t,e){return function(n,r){return t.call(this,tr(n,e),tr(r,e))}}(""+Eo).indexOf("[native code]")===-1&&(kt=De=N);const Io="unhandledrejection";function jo(t,e){var n;try{n=e.onuncatched(t)}catch{}if(n!==!1)try{var r,s={promise:e,reason:t};if(z.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(Io,!0,!0),ne(r,s)):z.CustomEvent&&ne(r=new CustomEvent(Io,{detail:s}),s),r&&z.dispatchEvent&&(dispatchEvent(r),!z.PromiseRejectionEvent&&z.onunhandledrejection))try{z.onunhandledrejection(r)}catch{}ve&&r&&!r.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var Y=C.reject;function Fs(t,e,n,r){if(t.idbdb&&(t._state.openComplete||D.letThrough||t._vip)){var s=t._createTransaction(e,n,t._dbSchema);try{s.create(),t._state.PR1398_maxLoop=3}catch(i){return i.name===Ps.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Fs(t,e,n,r))):Y(i)}return s._promise(e,(i,o)=>qe(()=>(D.trans=s,r(i,o,s)))).then(i=>s._completion.then(()=>i))}if(t._state.openComplete)return Y(new $.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return Y(new $.DatabaseClosed);t.open().catch(N)}return t._state.dbReadyPromise.then(()=>Fs(t,e,n,r))}const To="3.2.4",rt="ï¿¿",Ns=-1/0,Ae="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",Bo="String expected.",rn=[],nr=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Xu=nr,Zu=nr,Mo=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),rr="__dbnames",qs="readonly",zs="readwrite";function st(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const Ro={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function sr(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=Gt(e))[t],e)}class ec{_trans(e,n,r){const s=this._tx||D.trans,i=this.name;function o(u,c,h){if(!h.schema[i])throw new $.NotFound("Table "+i+" not part of transaction");return n(h.idbtrans,h)}const a=tn();try{return s&&s.db===this.db?s===D.trans?s._promise(e,o,r):qe(()=>s._promise(e,o,r),{trans:s,transless:D.transless||D}):Fs(this.db,e,[this.name],o)}finally{a&&nn()}}get(e,n){return e&&e.constructor===Object?this.where(e).first(n):this._trans("readonly",r=>this.core.get({trans:r,key:e}).then(s=>this.hook.reading.fire(s))).then(n)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Q(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const n=H(e);if(n.length===1)return this.where(n[0]).equals(e[n[0]]);const r=this.schema.indexes.concat(this.schema.primKey).filter(c=>c.compound&&n.every(h=>c.keyPath.indexOf(h)>=0)&&c.keyPath.every(h=>n.indexOf(h)>=0))[0];if(r&&this.db._maxKey!==rt)return this.where(r.name).equals(r.keyPath.map(c=>e[c]));!r&&ve&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${n.join("+")}]`);const{idxByName:s}=this.schema,i=this.db._deps.indexedDB;function o(c,h){try{return i.cmp(c,h)===0}catch{return!1}}const[a,u]=n.reduce(([c,h],l)=>{const d=s[l],f=e[l];return[c||d,c||!d?st(h,d&&d.multi?m=>{const p=Ke(m,l);return Q(p)&&p.some(v=>o(f,v))}:m=>o(f,Ke(m,l))):h]},[null,null]);return a?this.where(a.name).equals(e[a.keyPath]).filter(u):r?this.filter(u):this.where(n).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Q(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const n=r=>{if(!r)return r;const s=Object.create(e.prototype);for(var i in r)if(ue(r,i))try{s[i]=r[i]}catch{}return s};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=n,this.hook("reading",n),e}defineClass(){return this.mapToClass(function(e){ne(this,e)})}add(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=sr(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:n!=null?[n]:null,values:[i]})).then(o=>o.numFailures?C.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{fe(e,s,o)}catch{}return o})}update(e,n){if(typeof e!="object"||Q(e))return this.where(":id").equals(e).modify(n);{const r=Ke(e,this.schema.primKey.keyPath);if(r===void 0)return Y(new $.InvalidArgument("Given object does not contain its primary key"));try{typeof n!="function"?H(n).forEach(s=>{fe(e,s,n[s])}):n(e,{value:e,primKey:r})}catch{}return this.where(":id").equals(r).modify(n)}}put(e,n){const{auto:r,keyPath:s}=this.schema.primKey;let i=e;return s&&r&&(i=sr(s)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[i],keys:n!=null?[n]:null})).then(o=>o.numFailures?C.reject(o.failures[0]):o.lastResult).then(o=>{if(s)try{fe(e,s,o)}catch{}return o})}delete(e){return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:[e]})).then(n=>n.numFailures?C.reject(n.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:Ro})).then(e=>e.numFailures?C.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",n=>this.core.getMany({keys:e,trans:n}).then(r=>r.map(s=>this.hook.reading.fire(s))))}bulkAdd(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&s)throw new $.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&a?e.map(sr(u)):e;return this.core.mutate({trans:o,type:"add",keys:s,values:h,wantResults:i}).then(({numFailures:l,results:d,lastResult:f,failures:m})=>{if(l===0)return i?d:f;throw new Jt(`${this.name}.bulkAdd(): ${l} of ${c} operations failed`,m)})})}bulkPut(e,n,r){const s=Array.isArray(n)?n:void 0,i=(r=r||(s?void 0:n))?r.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:a,keyPath:u}=this.schema.primKey;if(u&&s)throw new $.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(s&&s.length!==e.length)throw new $.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let h=u&&a?e.map(sr(u)):e;return this.core.mutate({trans:o,type:"put",keys:s,values:h,wantResults:i}).then(({numFailures:l,results:d,lastResult:f,failures:m})=>{if(l===0)return i?d:f;throw new Jt(`${this.name}.bulkPut(): ${l} of ${c} operations failed`,m)})})}bulkDelete(e){const n=e.length;return this._trans("readwrite",r=>this.core.mutate({trans:r,type:"delete",keys:e})).then(({numFailures:r,lastResult:s,failures:i})=>{if(r===0)return s;throw new Jt(`${this.name}.bulkDelete(): ${r} of ${n} operations failed`,i)})}}function sn(t){var e={},n=function(o,a){if(a){for(var u=arguments.length,c=new Array(u-1);--u;)c[u-1]=arguments[u];return e[o].subscribe.apply(null,c),t}if(typeof o=="string")return e[o]};n.addEventType=i;for(var r=1,s=arguments.length;r<s;++r)i(arguments[r]);return n;function i(o,a,u){if(typeof o!="object"){var c;a||(a=Uu),u||(u=N);var h={subscribers:[],fire:u,subscribe:function(l){h.subscribers.indexOf(l)===-1&&(h.subscribers.push(l),h.fire=a(h.fire,l))},unsubscribe:function(l){h.subscribers=h.subscribers.filter(function(d){return d!==l}),h.fire=h.subscribers.reduce(a,u)}};return e[o]=n[o]=h,h}H(c=o).forEach(function(l){var d=c[l];if(Q(d))i(l,c[l][0],c[l][1]);else{if(d!=="asap")throw new $.InvalidArgument("Invalid event config");var f=i(l,Qt,function(){for(var m=arguments.length,p=new Array(m);m--;)p[m]=arguments[m];f.subscribers.forEach(function(v){fo(function(){v.apply(null,p)})})})}})}}function on(t,e){return bt(e).from({prototype:t}),e}function Pt(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Ls(t,e){t.filter=st(t.filter,e)}function Vs(t,e,n){var r=t.replayFilter;t.replayFilter=r?()=>st(r(),e()):e,t.justLimit=n&&!r}function ir(t,e){if(t.isPrimKey)return e.primaryKey;const n=e.getIndexByKeyPath(t.index);if(!n)throw new $.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Fo(t,e,n){const r=ir(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:r,range:t.range}})}function or(t,e,n,r){const s=t.replayFilter?st(t.filter,t.replayFilter()):t.filter;if(t.or){const i={},o=(a,u,c)=>{if(!s||s(u,c,d=>u.stop(d),d=>u.fail(d))){var h=u.primaryKey,l=""+h;l==="[object ArrayBuffer]"&&(l=""+new Uint8Array(h)),ue(i,l)||(i[l]=!0,e(a,u,c))}};return Promise.all([t.or._iterate(o,n),No(Fo(t,r,n),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return No(Fo(t,r,n),st(t.algorithm,s),e,!t.keysOnly&&t.valueMapper)}function No(t,e,n,r){var s=V(r?(i,o,a)=>n(r(i),o,a):n);return t.then(i=>{if(i)return i.start(()=>{var o=()=>i.continue();e&&!e(i,a=>o=a,a=>{i.stop(a),o=N},a=>{i.fail(a),o=N})||s(i.value,i,a=>o=a),o()})})}function re(t,e){try{const n=qo(t),r=qo(e);if(n!==r)return n==="Array"?1:r==="Array"?-1:n==="binary"?1:r==="binary"?-1:n==="string"?1:r==="string"?-1:n==="Date"?1:r!=="Date"?NaN:-1;switch(n){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(s,i){const o=s.length,a=i.length,u=o<a?o:a;for(let c=0;c<u;++c)if(s[c]!==i[c])return s[c]<i[c]?-1:1;return o===a?0:o<a?-1:1}(zo(t),zo(e));case"Array":return function(s,i){const o=s.length,a=i.length,u=o<a?o:a;for(let c=0;c<u;++c){const h=re(s[c],i[c]);if(h!==0)return h}return o===a?0:o<a?-1:1}(t,e)}}catch{}return NaN}function qo(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const n=_s(t);return n==="ArrayBuffer"?"binary":n}function zo(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class tc{_read(e,n){var r=this._ctx;return r.error?r.table._trans(null,Y.bind(null,r.error)):r.table._trans("readonly",e).then(n)}_write(e){var n=this._ctx;return n.error?n.table._trans(null,Y.bind(null,n.error)):n.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var n=this._ctx;n.algorithm=st(n.algorithm,e)}_iterate(e,n){return or(this._ctx,e,n,this._ctx.table.core)}clone(e){var n=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&ne(r,e),n._ctx=r,n}raw(){return this._ctx.valueMapper=null,this}each(e){var n=this._ctx;return this._read(r=>or(n,e,r,n.table.core))}count(e){return this._read(n=>{const r=this._ctx,s=r.table.core;if(Pt(r,!0))return s.count({trans:n,query:{index:ir(r,s.schema),range:r.range}}).then(o=>Math.min(o,r.limit));var i=0;return or(r,()=>(++i,!1),n,s).then(()=>i)}).then(e)}sortBy(e,n){const r=e.split(".").reverse(),s=r[0],i=r.length-1;function o(c,h){return h?o(c[r[h]],h-1):c[s]}var a=this._ctx.dir==="next"?1:-1;function u(c,h){var l=o(c,i),d=o(h,i);return l<d?-a:l>d?a:0}return this.toArray(function(c){return c.sort(u)}).then(n)}toArray(e){return this._read(n=>{var r=this._ctx;if(r.dir==="next"&&Pt(r,!0)&&r.limit>0){const{valueMapper:s}=r,i=ir(r,r.table.core.schema);return r.table.core.query({trans:n,limit:r.limit,values:!0,query:{index:i,range:r.range}}).then(({result:o})=>s?o.map(s):o)}{const s=[];return or(r,i=>s.push(i),n,r.table.core).then(()=>s)}},e)}offset(e){var n=this._ctx;return e<=0||(n.offset+=e,Pt(n)?Vs(n,()=>{var r=e;return(s,i)=>r===0||(r===1?(--r,!1):(i(()=>{s.advance(r),r=0}),!1))}):Vs(n,()=>{var r=e;return()=>--r<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),Vs(this._ctx,()=>{var n=e;return function(r,s,i){return--n<=0&&s(i),n>=0}},!0),this}until(e,n){return Ls(this._ctx,function(r,s,i){return!e(r.value)||(s(i),n)}),this}first(e){return this.limit(1).toArray(function(n){return n[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var n,r;return Ls(this._ctx,function(s){return e(s.value)}),n=this._ctx,r=e,n.isMatch=st(n.isMatch,r),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.key,s)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var n=this._ctx;return n.keysOnly=!n.isMatch,this.each(function(r,s){e(s.primaryKey,s)})}keys(e){var n=this._ctx;n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.key)}).then(function(){return r}).then(e)}primaryKeys(e){var n=this._ctx;if(n.dir==="next"&&Pt(n,!0)&&n.limit>0)return this._read(s=>{var i=ir(n,n.table.core.schema);return n.table.core.query({trans:s,values:!1,limit:n.limit,query:{index:i,range:n.range}})}).then(({result:s})=>s).then(e);n.keysOnly=!n.isMatch;var r=[];return this.each(function(s,i){r.push(i.primaryKey)}).then(function(){return r}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(n){return n[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,n=e.index&&e.table.schema.idxByName[e.index];if(!n||!n.multi)return this;var r={};return Ls(this._ctx,function(s){var i=s.primaryKey.toString(),o=ue(r,i);return r[i]=!0,!o}),this}modify(e){var n=this._ctx;return this._write(r=>{var s;if(typeof e=="function")s=e;else{var i=H(e),o=i.length;s=function(p){for(var v=!1,g=0;g<o;++g){var y=i[g],b=e[y];Ke(p,y)!==b&&(fe(p,y,b),v=!0)}return v}}const a=n.table.core,{outbound:u,extractKey:c}=a.schema.primaryKey,h=this.db._options.modifyChunkSize||200,l=[];let d=0;const f=[],m=(p,v)=>{const{failures:g,numFailures:y}=v;d+=p-y;for(let b of H(g))l.push(g[b])};return this.clone().primaryKeys().then(p=>{const v=g=>{const y=Math.min(h,p.length-g);return a.getMany({trans:r,keys:p.slice(g,g+y),cache:"immutable"}).then(b=>{const k=[],E=[],x=u?[]:null,_=[];for(let w=0;w<y;++w){const I=b[w],K={value:Gt(I),primKey:p[g+w]};s.call(K,K.value,K)!==!1&&(K.value==null?_.push(p[g+w]):u||re(c(I),c(K.value))===0?(E.push(K.value),u&&x.push(p[g+w])):(_.push(p[g+w]),k.push(K.value)))}const P=Pt(n)&&n.limit===1/0&&(typeof e!="function"||e===Us)&&{index:n.index,range:n.range};return Promise.resolve(k.length>0&&a.mutate({trans:r,type:"add",values:k}).then(w=>{for(let I in w.failures)_.splice(parseInt(I),1);m(k.length,w)})).then(()=>(E.length>0||P&&typeof e=="object")&&a.mutate({trans:r,type:"put",keys:x,values:E,criteria:P,changeSpec:typeof e!="function"&&e}).then(w=>m(E.length,w))).then(()=>(_.length>0||P&&e===Us)&&a.mutate({trans:r,type:"delete",keys:_,criteria:P}).then(w=>m(_.length,w))).then(()=>p.length>g+y&&v(g+h))})};return v(0).then(()=>{if(l.length>0)throw new Ln("Error modifying one or more objects",l,d,f);return p.length})})})}delete(){var e=this._ctx,n=e.range;return Pt(e)&&(e.isPrimKey&&!Zu||n.type===3)?this._write(r=>{const{primaryKey:s}=e.table.core.schema,i=n;return e.table.core.count({trans:r,query:{index:s,range:i}}).then(o=>e.table.core.mutate({trans:r,type:"deleteRange",range:i}).then(({failures:a,lastResult:u,results:c,numFailures:h})=>{if(h)throw new Ln("Could not delete some values",Object.keys(a).map(l=>a[l]),o-h);return o-h}))}):this.modify(Us)}}const Us=(t,e)=>e.value=null;function nc(t,e){return t<e?-1:t===e?0:1}function rc(t,e){return t>e?-1:t===e?0:1}function ce(t,e,n){var r=t instanceof Vo?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function St(t){return new t.Collection(t,()=>Lo("")).limit(0)}function sc(t,e,n,r,s,i){for(var o=Math.min(t.length,r.length),a=-1,u=0;u<o;++u){var c=e[u];if(c!==r[u])return s(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):s(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):a>=0?t.substr(0,a)+e[a]+n.substr(a+1):null;s(t[u],c)<0&&(a=u)}return o<r.length&&i==="next"?t+n.substr(t.length):o<t.length&&i==="prev"?t.substr(0,n.length):a<0?null:t.substr(0,a)+r[a]+n.substr(a+1)}function ar(t,e,n,r){var s,i,o,a,u,c,h,l=n.length;if(!n.every(p=>typeof p=="string"))return ce(t,Bo);function d(p){s=function(g){return g==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(p),i=function(g){return g==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(p),o=p==="next"?nc:rc;var v=n.map(function(g){return{lower:i(g),upper:s(g)}}).sort(function(g,y){return o(g.lower,y.lower)});a=v.map(function(g){return g.upper}),u=v.map(function(g){return g.lower}),c=p,h=p==="next"?"":r}d("next");var f=new t.Collection(t,()=>Le(a[0],u[l-1]+r));f._ondirectionchange=function(p){d(p)};var m=0;return f._addAlgorithm(function(p,v,g){var y=p.key;if(typeof y!="string")return!1;var b=i(y);if(e(b,u,m))return!0;for(var k=null,E=m;E<l;++E){var x=sc(y,b,a[E],u[E],o,c);x===null&&k===null?m=E+1:(k===null||o(k,x)>0)&&(k=x)}return v(k!==null?function(){p.continue(k+h)}:g),!1}),f}function Le(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Lo(t){return{type:1,lower:t,upper:t}}class Vo{get Collection(){return this._ctx.table.db.Collection}between(e,n,r,s){r=r!==!1,s=s===!0;try{return this._cmp(e,n)>0||this._cmp(e,n)===0&&(r||s)&&(!r||!s)?St(this):new this.Collection(this,()=>Le(e,n,!r,!s))}catch{return ce(this,Ae)}}equals(e){return e==null?ce(this,Ae):new this.Collection(this,()=>Lo(e))}above(e){return e==null?ce(this,Ae):new this.Collection(this,()=>Le(e,void 0,!0))}aboveOrEqual(e){return e==null?ce(this,Ae):new this.Collection(this,()=>Le(e,void 0,!1))}below(e){return e==null?ce(this,Ae):new this.Collection(this,()=>Le(void 0,e,!1,!0))}belowOrEqual(e){return e==null?ce(this,Ae):new this.Collection(this,()=>Le(void 0,e))}startsWith(e){return typeof e!="string"?ce(this,Bo):this.between(e,e+rt,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):ar(this,(n,r)=>n.indexOf(r[0])===0,[e],rt)}equalsIgnoreCase(e){return ar(this,(n,r)=>n===r[0],[e],"")}anyOfIgnoreCase(){var e=Oe.apply(_t,arguments);return e.length===0?St(this):ar(this,(n,r)=>r.indexOf(n)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Oe.apply(_t,arguments);return e.length===0?St(this):ar(this,(n,r)=>r.some(s=>n.indexOf(s)===0),e,rt)}anyOf(){const e=Oe.apply(_t,arguments);let n=this._cmp;try{e.sort(n)}catch{return ce(this,Ae)}if(e.length===0)return St(this);const r=new this.Collection(this,()=>Le(e[0],e[e.length-1]));r._ondirectionchange=i=>{n=i==="next"?this._ascending:this._descending,e.sort(n)};let s=0;return r._addAlgorithm((i,o,a)=>{const u=i.key;for(;n(u,e[s])>0;)if(++s,s===e.length)return o(a),!1;return n(u,e[s])===0||(o(()=>{i.continue(e[s])}),!1)}),r}notEqual(e){return this.inAnyRange([[Ns,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Oe.apply(_t,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return ce(this,Ae)}const n=e.reduce((r,s)=>r?r.concat([[r[r.length-1][1],s]]):[[Ns,s]],null);return n.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,n){const r=this._cmp,s=this._ascending,i=this._descending,o=this._min,a=this._max;if(e.length===0)return St(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&s(y[0],y[1])<=0))return ce(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",$.InvalidArgument);const u=!n||n.includeLowers!==!1,c=n&&n.includeUppers===!0;let h,l=s;function d(y,b){return l(y[0],b[0])}try{h=e.reduce(function(y,b){let k=0,E=y.length;for(;k<E;++k){const x=y[k];if(r(b[0],x[1])<0&&r(b[1],x[0])>0){x[0]=o(x[0],b[0]),x[1]=a(x[1],b[1]);break}}return k===E&&y.push(b),y},[]),h.sort(d)}catch{return ce(this,Ae)}let f=0;const m=c?y=>s(y,h[f][1])>0:y=>s(y,h[f][1])>=0,p=u?y=>i(y,h[f][0])>0:y=>i(y,h[f][0])>=0;let v=m;const g=new this.Collection(this,()=>Le(h[0][0],h[h.length-1][1],!u,!c));return g._ondirectionchange=y=>{y==="next"?(v=m,l=s):(v=p,l=i),h.sort(d)},g._addAlgorithm((y,b,k)=>{for(var E=y.key;v(E);)if(++f,f===h.length)return b(k),!1;return!!function(x){return!m(x)&&!p(x)}(E)||(this._cmp(E,h[f][1])===0||this._cmp(E,h[f][0])===0||b(()=>{l===s?y.continue(h[f][0]):y.continue(h[f][1])}),!1)}),g}startsWithAnyOf(){const e=Oe.apply(_t,arguments);return e.every(n=>typeof n=="string")?e.length===0?St(this):this.inAnyRange(e.map(n=>[n,n+rt])):ce(this,"startsWithAnyOf() only works with strings")}}function be(t){return V(function(e){return an(e),t(e.target.error),!1})}function an(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const un="storagemutated",Ve="x-storagemutated-1",Ue=sn(null,un);class ic{_lock(){return Yt(!D.global),++this._reculock,this._reculock!==1||D.global||(D.lockOwnerFor=this),this}_unlock(){if(Yt(!D.global),--this._reculock==0)for(D.global||(D.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{Et(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&D.lockOwnerFor!==this}create(e){if(!this.mode)return this;const n=this.db.idbdb,r=this.db._state.dbOpenError;if(Yt(!this.idbtrans),!e&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new $.DatabaseClosed(r);case"MissingAPIError":throw new $.MissingAPI(r.message,r);default:throw new $.OpenFailed(r)}if(!this.active)throw new $.TransactionInactive;return Yt(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):n.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=V(s=>{an(s),this._reject(e.error)}),e.onabort=V(s=>{an(s),this.active&&this._reject(new $.Abort(e.error)),this.active=!1,this.on("abort").fire(s)}),e.oncomplete=V(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Ue.storagemutated.fire(e.mutatedParts)}),this}_promise(e,n,r){if(e==="readwrite"&&this.mode!=="readwrite")return Y(new $.ReadOnly("Transaction is readonly"));if(!this.active)return Y(new $.TransactionInactive);if(this._locked())return new C((i,o)=>{this._blockedFuncs.push([()=>{this._promise(e,n,r).then(i,o)},D])});if(r)return qe(()=>{var i=new C((o,a)=>{this._lock();const u=n(o,a,this);u&&u.then&&u.then(o,a)});return i.finally(()=>this._unlock()),i._lib=!0,i});var s=new C((i,o)=>{var a=n(i,o,this);a&&a.then&&a.then(i,o)});return s._lib=!0,s}_root(){return this.parent?this.parent._root():this}waitFor(e){var n=this._root();const r=C.resolve(e);if(n._waitingFor)n._waitingFor=n._waitingFor.then(()=>r);else{n._waitingFor=r,n._waitingQueue=[];var s=n.idbtrans.objectStore(n.storeNames[0]);(function o(){for(++n._spinCount;n._waitingQueue.length;)n._waitingQueue.shift()();n._waitingFor&&(s.get(-1/0).onsuccess=o)})()}var i=n._waitingFor;return new C((o,a)=>{r.then(u=>n._waitingQueue.push(V(o.bind(null,u))),u=>n._waitingQueue.push(V(a.bind(null,u)))).finally(()=>{n._waitingFor===i&&(n._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new $.Abort))}table(e){const n=this._memoizedTables||(this._memoizedTables={});if(ue(n,e))return n[e];const r=this.schema[e];if(!r)throw new $.NotFound("Table "+e+" not part of transaction");const s=new this.db.Table(e,r,this);return s.core=this.db.core.table(e),n[e]=s,s}}function Hs(t,e,n,r,s,i,o){return{name:t,keyPath:e,unique:n,multi:r,auto:s,compound:i,src:(n&&!o?"&":"")+(r?"*":"")+(s?"++":"")+Uo(e)}}function Uo(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function Ho(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:po(n,r=>[r.name,r])}}let cn=t=>{try{return t.only([[]]),cn=()=>[[]],[[]]}catch{return cn=()=>rt,rt}};function Ws(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?r=>r[e]:r=>Ke(r,e)}(t):e=>Ke(e,t)}function Wo(t){return[].slice.call(t)}let oc=0;function ln(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function ac(t,e,n){function r(u){if(u.type===3)return null;if(u.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:h,lowerOpen:l,upperOpen:d}=u;return c===void 0?h===void 0?null:e.upperBound(h,!!d):h===void 0?e.lowerBound(c,!!l):e.bound(c,h,!!l,!!d)}const{schema:s,hasGetAll:i}=function(u,c){const h=Wo(u.objectStoreNames);return{schema:{name:u.name,tables:h.map(l=>c.objectStore(l)).map(l=>{const{keyPath:d,autoIncrement:f}=l,m=Q(d),p=d==null,v={},g={name:l.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:p,compound:m,keyPath:d,autoIncrement:f,unique:!0,extractKey:Ws(d)},indexes:Wo(l.indexNames).map(y=>l.index(y)).map(y=>{const{name:b,unique:k,multiEntry:E,keyPath:x}=y,_={name:b,compound:Q(x),keyPath:x,unique:k,multiEntry:E,extractKey:Ws(x)};return v[ln(x)]=_,_}),getIndexByKeyPath:y=>v[ln(y)]};return v[":id"]=g.primaryKey,d!=null&&(v[ln(d)]=g.primaryKey),g})},hasGetAll:h.length>0&&"getAll"in c.objectStore(h[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,n),o=s.tables.map(u=>function(c){const h=c.name;return{name:h,schema:c,mutate:function({trans:l,type:d,keys:f,values:m,range:p}){return new Promise((v,g)=>{v=V(v);const y=l.objectStore(h),b=y.keyPath==null,k=d==="put"||d==="add";if(!k&&d!=="delete"&&d!=="deleteRange")throw new Error("Invalid operation type: "+d);const{length:E}=f||m||{length:1};if(f&&m&&f.length!==m.length)throw new Error("Given keys array must have same length as given values array.");if(E===0)return v({numFailures:0,failures:{},results:[],lastResult:void 0});let x;const _=[],P=[];let w=0;const I=M=>{++w,an(M)};if(d==="deleteRange"){if(p.type===4)return v({numFailures:w,failures:P,results:[],lastResult:void 0});p.type===3?_.push(x=y.clear()):_.push(x=y.delete(r(p)))}else{const[M,T]=k?b?[m,f]:[m,null]:[f,null];if(k)for(let j=0;j<E;++j)_.push(x=T&&T[j]!==void 0?y[d](M[j],T[j]):y[d](M[j])),x.onerror=I;else for(let j=0;j<E;++j)_.push(x=y[d](M[j])),x.onerror=I}const K=M=>{const T=M.target.result;_.forEach((j,le)=>j.error!=null&&(P[le]=j.error)),v({numFailures:w,failures:P,results:d==="delete"?f:_.map(j=>j.result),lastResult:T})};x.onerror=M=>{I(M),K(M)},x.onsuccess=K})},getMany:({trans:l,keys:d})=>new Promise((f,m)=>{f=V(f);const p=l.objectStore(h),v=d.length,g=new Array(v);let y,b=0,k=0;const E=_=>{const P=_.target;g[P._pos]=P.result,++k===b&&f(g)},x=be(m);for(let _=0;_<v;++_)d[_]!=null&&(y=p.get(d[_]),y._pos=_,y.onsuccess=E,y.onerror=x,++b);b===0&&f(g)}),get:({trans:l,key:d})=>new Promise((f,m)=>{f=V(f);const p=l.objectStore(h).get(d);p.onsuccess=v=>f(v.target.result),p.onerror=be(m)}),query:function(l){return d=>new Promise((f,m)=>{f=V(f);const{trans:p,values:v,limit:g,query:y}=d,b=g===1/0?void 0:g,{index:k,range:E}=y,x=p.objectStore(h),_=k.isPrimaryKey?x:x.index(k.name),P=r(E);if(g===0)return f({result:[]});if(l){const w=v?_.getAll(P,b):_.getAllKeys(P,b);w.onsuccess=I=>f({result:I.target.result}),w.onerror=be(m)}else{let w=0;const I=v||!("openKeyCursor"in _)?_.openCursor(P):_.openKeyCursor(P),K=[];I.onsuccess=M=>{const T=I.result;return T?(K.push(v?T.value:T.primaryKey),++w===g?f({result:K}):void T.continue()):f({result:K})},I.onerror=be(m)}})}(i),openCursor:function({trans:l,values:d,query:f,reverse:m,unique:p}){return new Promise((v,g)=>{v=V(v);const{index:y,range:b}=f,k=l.objectStore(h),E=y.isPrimaryKey?k:k.index(y.name),x=m?p?"prevunique":"prev":p?"nextunique":"next",_=d||!("openKeyCursor"in E)?E.openCursor(r(b),x):E.openKeyCursor(r(b),x);_.onerror=be(g),_.onsuccess=V(P=>{const w=_.result;if(!w)return void v(null);w.___id=++oc,w.done=!1;const I=w.continue.bind(w);let K=w.continuePrimaryKey;K&&(K=K.bind(w));const M=w.advance.bind(w),T=()=>{throw new Error("Cursor not stopped")};w.trans=l,w.stop=w.continue=w.continuePrimaryKey=w.advance=()=>{throw new Error("Cursor not started")},w.fail=V(g),w.next=function(){let j=1;return this.start(()=>j--?this.continue():this.stop()).then(()=>this)},w.start=j=>{const le=new Promise((R,se)=>{R=V(R),_.onerror=be(se),w.fail=se,w.stop=ye=>{w.stop=w.continue=w.continuePrimaryKey=w.advance=T,R(ye)}}),he=()=>{if(_.result)try{j()}catch(R){w.fail(R)}else w.done=!0,w.start=()=>{throw new Error("Cursor behind last entry")},w.stop()};return _.onsuccess=V(R=>{_.onsuccess=he,he()}),w.continue=I,w.continuePrimaryKey=K,w.advance=M,he(),le},v(w)},g)})},count({query:l,trans:d}){const{index:f,range:m}=l;return new Promise((p,v)=>{const g=d.objectStore(h),y=f.isPrimaryKey?g:g.index(f.name),b=r(m),k=b?y.count(b):y.count();k.onsuccess=V(E=>p(E.target.result)),k.onerror=be(v)})}}}(u)),a={};return o.forEach(u=>a[u.name]=u),{stack:"dbcore",transaction:t.transaction.bind(t),table(u){if(!a[u])throw new Error(`Table '${u}' not found`);return a[u]},MIN_KEY:-1/0,MAX_KEY:cn(e),schema:s}}function Ys({_novip:t},e){const n=e.db,r=function(s,i,{IDBKeyRange:o,indexedDB:a},u){return{dbcore:function(h,l){return l.reduce((d,{create:f})=>({...d,...f(d)}),h)}(ac(i,o,u),s.dbcore)}}(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(s=>{const i=s.name;t.core.schema.tables.some(o=>o.name===i)&&(s.core=t.core.table(i),t[i]instanceof t.Table&&(t[i].core=s.core))})}function ur({_novip:t},e,n,r){n.forEach(s=>{const i=r[s];e.forEach(o=>{const a=vs(o,s);(!a||"value"in a&&a.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Ce(o,s,{get(){return this.table(s)},set(u){lo(this,s,{value:u,writable:!0,configurable:!0,enumerable:!0})}}):o[s]=new t.Table(s,i))})})}function Gs({_novip:t},e){e.forEach(n=>{for(let r in n)n[r]instanceof t.Table&&delete n[r]})}function uc(t,e){return t._cfg.version-e._cfg.version}function cc(t,e,n,r){const s=t._dbSchema,i=t._createTransaction("readwrite",t._storeNames,s);i.create(n),i._completion.catch(r);const o=i._reject.bind(i),a=D.transless||D;qe(()=>{D.trans=i,D.transless=a,e===0?(H(s).forEach(u=>{Js(n,u,s[u].primKey,s[u].indexes)}),Ys(t,n),C.follow(()=>t.on.populate.fire(i)).catch(o)):function({_novip:u},c,h,l){const d=[],f=u._versions;let m=u._dbSchema=Xs(u,u.idbdb,l),p=!1;const v=f.filter(y=>y._cfg.version>=c);function g(){return d.length?C.resolve(d.shift()(h.idbtrans)).then(g):C.resolve()}return v.forEach(y=>{d.push(()=>{const b=m,k=y._cfg.dbschema;Zs(u,b,l),Zs(u,k,l),m=u._dbSchema=k;const E=Yo(b,k);E.add.forEach(_=>{Js(l,_[0],_[1].primKey,_[1].indexes)}),E.change.forEach(_=>{if(_.recreate)throw new $.Upgrade("Not yet support for changing primary key");{const P=l.objectStore(_.name);_.add.forEach(w=>Qs(P,w)),_.change.forEach(w=>{P.deleteIndex(w.name),Qs(P,w)}),_.del.forEach(w=>P.deleteIndex(w))}});const x=y._cfg.contentUpgrade;if(x&&y._cfg.version>c){Ys(u,l),h._memoizedTables={},p=!0;let _=yo(k);E.del.forEach(K=>{_[K]=b[K]}),Gs(u,[u.Transaction.prototype]),ur(u,[u.Transaction.prototype],H(_),_),h.schema=_;const P=xs(x);let w;P&&kt();const I=C.follow(()=>{if(w=x(h),w&&P){var K=De.bind(null,null);w.then(K,K)}});return w&&typeof w.then=="function"?C.resolve(w):I.then(()=>w)}}),d.push(b=>{(!p||!Xu)&&function(k,E){[].slice.call(E.db.objectStoreNames).forEach(x=>k[x]==null&&E.db.deleteObjectStore(x))}(y._cfg.dbschema,b),Gs(u,[u.Transaction.prototype]),ur(u,[u.Transaction.prototype],u._storeNames,u._dbSchema),h.schema=u._dbSchema})}),g().then(()=>{var y,b;b=l,H(y=m).forEach(k=>{b.db.objectStoreNames.contains(k)||Js(b,k,y[k].primKey,y[k].indexes)})})}(t,e,i,n).catch(o)})}function Yo(t,e){const n={del:[],add:[],change:[]};let r;for(r in t)e[r]||n.del.push(r);for(r in e){const s=t[r],i=e[r];if(s){const o={name:r,def:i,recreate:!1,del:[],add:[],change:[]};if(""+(s.primKey.keyPath||"")!=""+(i.primKey.keyPath||"")||s.primKey.auto!==i.primKey.auto&&!nr)o.recreate=!0,n.change.push(o);else{const a=s.idxByName,u=i.idxByName;let c;for(c in a)u[c]||o.del.push(c);for(c in u){const h=a[c],l=u[c];h?h.src!==l.src&&o.change.push(l):o.add.push(l)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,i])}return n}function Js(t,e,n,r){const s=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(i=>Qs(s,i)),s}function Qs(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function Xs(t,e,n){const r={};return zn(e.objectStoreNames,0).forEach(s=>{const i=n.objectStore(s);let o=i.keyPath;const a=Hs(Uo(o),o||"",!1,!1,!!i.autoIncrement,o&&typeof o!="string",!0),u=[];for(let h=0;h<i.indexNames.length;++h){const l=i.index(i.indexNames[h]);o=l.keyPath;var c=Hs(l.name,o,!!l.unique,!!l.multiEntry,!1,o&&typeof o!="string",!1);u.push(c)}r[s]=Ho(s,a,u)}),r}function Zs({_novip:t},e,n){const r=n.db.objectStoreNames;for(let s=0;s<r.length;++s){const i=r[s],o=n.objectStore(i);t._hasGetAll="getAll"in o;for(let a=0;a<o.indexNames.length;++a){const u=o.indexNames[a],c=o.index(u).keyPath,h=typeof c=="string"?c:"["+zn(c).join("+")+"]";if(e[i]){const l=e[i].idxByName[h];l&&(l.name=u,delete e[i].idxByName[h],e[i].idxByName[u]=l)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&z.WorkerGlobalScope&&z instanceof z.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class lc{_parseStoresSpec(e,n){H(e).forEach(r=>{if(e[r]!==null){var s=e[r].split(",").map((o,a)=>{const u=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(u)?u.match(/^\[(.*)\]$/)[1].split("+"):u;return Hs(u,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),Q(c),a===0)}),i=s.shift();if(i.multi)throw new $.Schema("Primary key cannot be multi-valued");s.forEach(o=>{if(o.auto)throw new $.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new $.Schema("Index must have a name and cannot be an empty string")}),n[r]=Ho(r,i,s)}})}stores(e){const n=this.db;this._cfg.storesSource=this._cfg.storesSource?ne(this._cfg.storesSource,e):e;const r=n._versions,s={};let i={};return r.forEach(o=>{ne(s,o._cfg.storesSource),i=o._cfg.dbschema={},o._parseStoresSpec(s,i)}),n._dbSchema=i,Gs(n,[n._allTables,n,n.Transaction.prototype]),ur(n,[n._allTables,n,n.Transaction.prototype,this._cfg.tables],H(i),i),n._storeNames=H(i),this}upgrade(e){return this._cfg.contentUpgrade=Ss(this._cfg.contentUpgrade||N,e),this}}function ei(t,e){let n=t._dbNamesDB;return n||(n=t._dbNamesDB=new it(rr,{addons:[],indexedDB:t,IDBKeyRange:e}),n.version(1).stores({dbnames:"name"})),n.table("dbnames")}function ti(t){return t&&typeof t.databases=="function"}function ni(t){return qe(function(){return D.letThrough=!0,t()})}function hc(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var n=function(){return indexedDB.databases().finally(e)};t=setInterval(n,100),n()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function dc(t){const e=t._state,{indexedDB:n}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?Y(e.dbOpenError):t);ve&&(e.openCanceller._stackHolder=Ze()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const r=e.openCanceller;function s(){if(e.openCanceller!==r)throw new $.DatabaseClosed("db.open() was cancelled")}let i=e.dbReadyResolve,o=null,a=!1;return C.race([r,(typeof navigator>"u"?C.resolve():hc()).then(()=>new C((u,c)=>{if(s(),!n)throw new $.MissingAPI;const h=t.name,l=e.autoSchema?n.open(h):n.open(h,Math.round(10*t.verno));if(!l)throw new $.MissingAPI;l.onerror=be(c),l.onblocked=V(t._fireOnBlocked),l.onupgradeneeded=V(d=>{if(o=l.transaction,e.autoSchema&&!t._options.allowEmptyDB){l.onerror=an,o.abort(),l.result.close();const m=n.deleteDatabase(h);m.onsuccess=m.onerror=V(()=>{c(new $.NoSuchDatabase(`Database ${h} doesnt exist`))})}else{o.onerror=be(c);var f=d.oldVersion>Math.pow(2,62)?0:d.oldVersion;a=f<1,t._novip.idbdb=l.result,cc(t,f/10,o,c)}},c),l.onsuccess=V(()=>{o=null;const d=t._novip.idbdb=l.result,f=zn(d.objectStoreNames);if(f.length>0)try{const p=d.transaction((m=f).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:v},g,y){v.verno=g.version/10;const b=v._dbSchema=Xs(0,g,y);v._storeNames=zn(g.objectStoreNames,0),ur(v,[v._allTables],H(b),b)}(t,d,p):(Zs(t,t._dbSchema,p),function(v,g){const y=Yo(Xs(0,v.idbdb,g),v._dbSchema);return!(y.add.length||y.change.some(b=>b.add.length||b.change.length))}(t,p)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),Ys(t,p)}catch{}var m;rn.push(t),d.onversionchange=V(p=>{e.vcFired=!0,t.on("versionchange").fire(p)}),d.onclose=V(p=>{t.on("close").fire(p)}),a&&function({indexedDB:p,IDBKeyRange:v},g){!ti(p)&&g!==rr&&ei(p,v).put({name:g}).catch(N)}(t._deps,h),u()},c)}))]).then(()=>(s(),e.onReadyBeingFired=[],C.resolve(ni(()=>t.on.ready.fire(t.vip))).then(function u(){if(e.onReadyBeingFired.length>0){let c=e.onReadyBeingFired.reduce(Ss,N);return e.onReadyBeingFired=[],C.resolve(ni(()=>c(t.vip))).then(u)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(u=>{e.dbOpenError=u;try{o&&o.abort()}catch{}return r===e.openCanceller&&t._close(),Y(u)}).finally(()=>{e.openComplete=!0,i()})}function ri(t){var e=i=>t.next(i),n=s(e),r=s(i=>t.throw(i));function s(i){return o=>{var a=i(o),u=a.value;return a.done?u:u&&typeof u.then=="function"?u.then(n,r):Q(u)?Promise.all(u).then(n,r):n(u)}}return s(e)()}function fc(t,e,n){var r=arguments.length;if(r<2)throw new $.InvalidArgument("Too few arguments");for(var s=new Array(r-1);--r;)s[r-1]=arguments[r];return n=s.pop(),[t,mo(s),n]}function Go(t,e,n,r,s){return C.resolve().then(()=>{const i=D.transless||D,o=t._createTransaction(e,n,t._dbSchema,r),a={trans:o,transless:i};if(r)o.idbtrans=r.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(l){return l.name===Ps.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>Go(t,e,n,null,s))):Y(l)}const u=xs(s);let c;u&&kt();const h=C.follow(()=>{if(c=s.call(o,o),c)if(u){var l=De.bind(null,null);c.then(l,l)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=ri(c))},a);return(c&&typeof c.then=="function"?C.resolve(c).then(l=>o.active?l:Y(new $.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):h.then(()=>c)).then(l=>(r&&o._resolve(),o._completion.then(()=>l))).catch(l=>(o._reject(l),Y(l)))})}function cr(t,e,n){const r=Q(t)?t.slice():[t];for(let s=0;s<n;++s)r.push(e);return r}const pc={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const n=t.table(e),{schema:r}=n,s={},i=[];function o(h,l,d){const f=ln(h),m=s[f]=s[f]||[],p=h==null?0:typeof h=="string"?1:h.length,v=l>0,g={...d,isVirtual:v,keyTail:l,keyLength:p,extractKey:Ws(h),unique:!v&&d.unique};return m.push(g),g.isPrimaryKey||i.push(g),p>1&&o(p===2?h[0]:h.slice(0,p-1),l+1,d),m.sort((y,b)=>y.keyTail-b.keyTail),g}const a=o(r.primaryKey.keyPath,0,r.primaryKey);s[":id"]=[a];for(const h of r.indexes)o(h.keyPath,0,h);function u(h){const l=h.query.index;return l.isVirtual?{...h,query:{index:l,range:(d=h.query.range,f=l.keyTail,{type:d.type===1?2:d.type,lower:cr(d.lower,d.lowerOpen?t.MAX_KEY:t.MIN_KEY,f),lowerOpen:!0,upper:cr(d.upper,d.upperOpen?t.MIN_KEY:t.MAX_KEY,f),upperOpen:!0})}}:h;var d,f}return{...n,schema:{...r,primaryKey:a,indexes:i,getIndexByKeyPath:function(h){const l=s[ln(h)];return l&&l[0]}},count:h=>n.count(u(h)),query:h=>n.query(u(h)),openCursor(h){const{keyTail:l,isVirtual:d,keyLength:f}=h.query.index;return d?n.openCursor(u(h)).then(m=>m&&function(p){return Object.create(p,{continue:{value:function(g){g!=null?p.continue(cr(g,h.reverse?t.MAX_KEY:t.MIN_KEY,l)):h.unique?p.continue(p.key.slice(0,f).concat(h.reverse?t.MIN_KEY:t.MAX_KEY,l)):p.continue()}},continuePrimaryKey:{value(g,y){p.continuePrimaryKey(cr(g,t.MAX_KEY,l),y)}},primaryKey:{get:()=>p.primaryKey},key:{get(){const g=p.key;return f===1?g[0]:g.slice(0,f)}},value:{get:()=>p.value}})}(m)):n.openCursor(h)}}}}}};function si(t,e,n,r){return n=n||{},r=r||"",H(t).forEach(s=>{if(ue(e,s)){var i=t[s],o=e[s];if(typeof i=="object"&&typeof o=="object"&&i&&o){const a=_s(i);a!==_s(o)?n[r+s]=e[s]:a==="Object"?si(i,o,n,r+s+"."):i!==o&&(n[r+s]=e[s])}else i!==o&&(n[r+s]=e[s])}else n[r+s]=void 0}),H(e).forEach(s=>{ue(t,s)||(n[r+s]=e[s])}),n}const yc={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const n=t.table(e),{primaryKey:r}=n.schema;return{...n,mutate(i){const o=D.trans,{deleting:a,creating:u,updating:c}=o.table(e).hook;switch(i.type){case"add":if(u.fire===N)break;return o._promise("readwrite",()=>h(i),!0);case"put":if(u.fire===N&&c.fire===N)break;return o._promise("readwrite",()=>h(i),!0);case"delete":if(a.fire===N)break;return o._promise("readwrite",()=>h(i),!0);case"deleteRange":if(a.fire===N)break;return o._promise("readwrite",()=>function(d){return l(d.trans,d.range,1e4)}(i),!0)}return n.mutate(i);function h(d){const f=D.trans,m=d.keys||function(p,v){return v.type==="delete"?v.keys:v.keys||v.values.map(p.extractKey)}(r,d);if(!m)throw new Error("Keys missing");return(d=d.type==="add"||d.type==="put"?{...d,keys:m}:{...d}).type!=="delete"&&(d.values=[...d.values]),d.keys&&(d.keys=[...d.keys]),function(p,v,g){return v.type==="add"?Promise.resolve([]):p.getMany({trans:v.trans,keys:g,cache:"immutable"})}(n,d,m).then(p=>{const v=m.map((g,y)=>{const b=p[y],k={onerror:null,onsuccess:null};if(d.type==="delete")a.fire.call(k,g,b,f);else if(d.type==="add"||b===void 0){const E=u.fire.call(k,g,d.values[y],f);g==null&&E!=null&&(g=E,d.keys[y]=g,r.outbound||fe(d.values[y],r.keyPath,g))}else{const E=si(b,d.values[y]),x=c.fire.call(k,E,g,b,f);if(x){const _=d.values[y];Object.keys(x).forEach(P=>{ue(_,P)?_[P]=x[P]:fe(_,P,x[P])})}}return k});return n.mutate(d).then(({failures:g,results:y,numFailures:b,lastResult:k})=>{for(let E=0;E<m.length;++E){const x=y?y[E]:m[E],_=v[E];x==null?_.onerror&&_.onerror(g[E]):_.onsuccess&&_.onsuccess(d.type==="put"&&p[E]?d.values[E]:x)}return{failures:g,results:y,numFailures:b,lastResult:k}}).catch(g=>(v.forEach(y=>y.onerror&&y.onerror(g)),Promise.reject(g)))})}function l(d,f,m){return n.query({trans:d,values:!1,query:{index:r,range:f},limit:m}).then(({result:p})=>h({type:"delete",keys:p,trans:d}).then(v=>v.numFailures>0?Promise.reject(v.failures[0]):p.length<m?{failures:[],numFailures:0,lastResult:void 0}:l(d,{...f,lower:p[p.length-1],lowerOpen:!0},m)))}}}}})};function Jo(t,e,n){try{if(!e||e.keys.length<t.length)return null;const r=[];for(let s=0,i=0;s<e.keys.length&&i<t.length;++s)re(e.keys[s],t[i])===0&&(r.push(n?Gt(e.values[s]):e.values[s]),++i);return r.length===t.length?r:null}catch{return null}}const mc={stack:"dbcore",level:-1,create:t=>({table:e=>{const n=t.table(e);return{...n,getMany:r=>{if(!r.cache)return n.getMany(r);const s=Jo(r.keys,r.trans._cache,r.cache==="clone");return s?C.resolve(s):n.getMany(r).then(i=>(r.trans._cache={keys:r.keys,values:r.cache==="clone"?Gt(i):i},i))},mutate:r=>(r.type!=="add"&&(r.trans._cache=null),n.mutate(r))}}})};function ii(t){return!("from"in t)}const $e=function(t,e){if(!this){const n=new $e;return t&&"d"in t&&ne(n,t),n}ne(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function hn(t,e,n){const r=re(e,n);if(isNaN(r))return;if(r>0)throw RangeError();if(ii(t))return ne(t,{from:e,to:n,d:1});const s=t.l,i=t.r;if(re(n,t.from)<0)return s?hn(s,e,n):t.l={from:e,to:n,d:1,l:null,r:null},Qo(t);if(re(e,t.to)>0)return i?hn(i,e,n):t.r={from:e,to:n,d:1,l:null,r:null},Qo(t);re(e,t.from)<0&&(t.from=e,t.l=null,t.d=i?i.d+1:1),re(n,t.to)>0&&(t.to=n,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;s&&!t.l&&lr(t,s),i&&o&&lr(t,i)}function lr(t,e){ii(e)||function n(r,{from:s,to:i,l:o,r:a}){hn(r,s,i),o&&n(r,o),a&&n(r,a)}(t,e)}function gc(t,e){const n=oi(e);let r=n.next();if(r.done)return!1;let s=r.value;const i=oi(t);let o=i.next(s.from),a=o.value;for(;!r.done&&!o.done;){if(re(a.from,s.to)<=0&&re(a.to,s.from)>=0)return!0;re(s.from,a.from)<0?s=(r=n.next(a.from)).value:a=(o=i.next(s.from)).value}return!1}function oi(t){let e=ii(t)?null:{s:0,n:t};return{next(n){const r=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,r)for(;e.n.l&&re(n,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!r||re(n,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function Qo(t){var e,n;const r=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((n=t.l)===null||n===void 0?void 0:n.d)||0),s=r>1?"r":r<-1?"l":"";if(s){const i=s==="r"?"l":"r",o={...t},a=t[s];t.from=a.from,t.to=a.to,t[s]=a[s],o[s]=a[i],t[i]=o,o.d=Xo(o)}t.d=Xo(t)}function Xo({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}vt($e.prototype,{add(t){return lr(this,t),this},addKey(t){return hn(this,t,t),this},addKeys(t){return t.forEach(e=>hn(this,e,e)),this},[ws](){return oi(this)}});const vc={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,n=new $e(t.MIN_KEY,t.MAX_KEY);return{...t,table:r=>{const s=t.table(r),{schema:i}=s,{primaryKey:o}=i,{extractKey:a,outbound:u}=o,c={...s,mutate:d=>{const f=d.trans,m=f.mutatedParts||(f.mutatedParts={}),p=x=>{const _=`idb://${e}/${r}/${x}`;return m[_]||(m[_]=new $e)},v=p(""),g=p(":dels"),{type:y}=d;let[b,k]=d.type==="deleteRange"?[d.range]:d.type==="delete"?[d.keys]:d.values.length<50?[[],d.values]:[];const E=d.trans._cache;return s.mutate(d).then(x=>{if(Q(b)){y!=="delete"&&(b=x.results),v.addKeys(b);const _=Jo(b,E);_||y==="add"||g.addKeys(b),(_||k)&&function(P,w,I,K){function M(T){const j=P(T.name||"");function le(R){return R!=null?T.extractKey(R):null}const he=R=>T.multiEntry&&Q(R)?R.forEach(se=>j.addKey(se)):j.addKey(R);(I||K).forEach((R,se)=>{const ye=I&&le(I[se]),ut=K&&le(K[se]);re(ye,ut)!==0&&(ye!=null&&he(ye),ut!=null&&he(ut))})}w.indexes.forEach(M)}(p,i,_,k)}else if(b){const _={from:b.lower,to:b.upper};g.add(_),v.add(_)}else v.add(n),g.add(n),i.indexes.forEach(_=>p(_.name).add(n));return x})}},h=({query:{index:d,range:f}})=>{var m,p;return[d,new $e((m=f.lower)!==null&&m!==void 0?m:t.MIN_KEY,(p=f.upper)!==null&&p!==void 0?p:t.MAX_KEY)]},l={get:d=>[o,new $e(d.key)],getMany:d=>[o,new $e().addKeys(d.keys)],count:h,query:h,openCursor:h};return H(l).forEach(d=>{c[d]=function(f){const{subscr:m}=D;if(m){const p=k=>{const E=`idb://${e}/${r}/${k}`;return m[E]||(m[E]=new $e)},v=p(""),g=p(":dels"),[y,b]=l[d](f);if(p(y.name||"").add(b),!y.isPrimaryKey){if(d!=="count"){const k=d==="query"&&u&&f.values&&s.query({...f,values:!1});return s[d].apply(this,arguments).then(E=>{if(d==="query"){if(u&&f.values)return k.then(({result:_})=>(v.addKeys(_),E));const x=f.values?E.result.map(a):E.result;f.values?v.addKeys(x):g.addKeys(x)}else if(d==="openCursor"){const x=E,_=f.values;return x&&Object.create(x,{key:{get:()=>(g.addKey(x.primaryKey),x.key)},primaryKey:{get(){const P=x.primaryKey;return g.addKey(P),P}},value:{get:()=>(_&&v.addKey(x.primaryKey),x.value)}})}return E})}g.add(n)}}return s[d].apply(this,arguments)}}),c}}}};class it{constructor(e,n){this._middlewares={},this.verno=0;const r=it.dependencies;this._options=n={addons:it.addons,autoOpen:!0,indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange,...n},this._deps={indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange};const{addons:s}=n;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const i={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:N,dbReadyPromise:null,cancelOpen:N,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;i.dbReadyPromise=new C(a=>{i.dbReadyResolve=a}),i.openCanceller=new C((a,u)=>{i.cancelOpen=u}),this._state=i,this.name=e,this.on=sn(this,"populate","blocked","versionchange","close",{ready:[Ss,N]}),this.on.ready.subscribe=ho(this.on.ready.subscribe,a=>(u,c)=>{it.vip(()=>{const h=this._state;if(h.openComplete)h.dbOpenError||C.resolve().then(u),c&&a(u);else if(h.onReadyBeingFired)h.onReadyBeingFired.push(u),c&&a(u);else{a(u);const l=this;c||a(function d(){l.on.ready.unsubscribe(u),l.on.ready.unsubscribe(d)})}})}),this.Collection=(o=this,on(tc.prototype,function(a,u){this.db=o;let c=Ro,h=null;if(u)try{c=u()}catch(m){h=m}const l=a._ctx,d=l.table,f=d.hook.reading.fire;this._ctx={table:d,index:l.index,isPrimKey:!l.index||d.schema.primKey.keyPath&&l.index===d.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:h,or:l.or,valueMapper:f!==Qt?f:null}})),this.Table=function(a){return on(ec.prototype,function(u,c,h){this.db=a,this._tx=h,this.name=u,this.schema=c,this.hook=a._allTables[u]?a._allTables[u].hook:sn(null,{creating:[zu,N],reading:[qu,Qt],updating:[Vu,N],deleting:[Lu,N]})})}(this),this.Transaction=function(a){return on(ic.prototype,function(u,c,h,l,d){this.db=a,this.mode=u,this.storeNames=c,this.schema=h,this.chromeTransactionDurability=l,this.idbtrans=null,this.on=sn(this,"complete","error","abort"),this.parent=d||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new C((f,m)=>{this._resolve=f,this._reject=m}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},f=>{var m=this.active;return this.active=!1,this.on.error.fire(f),this.parent?this.parent._reject(f):m&&this.idbtrans&&this.idbtrans.abort(),Y(f)})})}(this),this.Version=function(a){return on(lc.prototype,function(u){this.db=a,this._cfg={version:u,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(a){return on(Vo.prototype,function(u,c,h){this.db=a,this._ctx={table:u,index:c===":id"?null:c,or:h};const l=a._deps.indexedDB;if(!l)throw new $.MissingAPI;this._cmp=this._ascending=l.cmp.bind(l),this._descending=(d,f)=>l.cmp(f,d),this._max=(d,f)=>l.cmp(d,f)>0?d:f,this._min=(d,f)=>l.cmp(d,f)<0?d:f,this._IDBKeyRange=a._deps.IDBKeyRange})}(this),this.on("versionchange",a=>{a.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",a=>{!a.newVersion||a.newVersion<a.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${a.oldVersion/10}`)}),this._maxKey=cn(n.IDBKeyRange),this._createTransaction=(a,u,c,h)=>new this.Transaction(a,u,c,this._options.chromeTransactionDurability,h),this._fireOnBlocked=a=>{this.on("blocked").fire(a),rn.filter(u=>u.name===this.name&&u!==this&&!u._state.vcFired).map(u=>u.on("versionchange").fire(a))},this.use(pc),this.use(yc),this.use(vc),this.use(mc),this.vip=Object.create(this,{_vip:{value:!0}}),s.forEach(a=>a(this))}version(e){if(isNaN(e)||e<.1)throw new $.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new $.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const n=this._versions;var r=n.filter(s=>s._cfg.version===e)[0];return r||(r=new this.Version(e),n.push(r),n.sort(uc),r.stores({}),this._state.autoSchema=!1,r)}_whenReady(e){return this.idbdb&&(this._state.openComplete||D.letThrough||this._vip)?e():new C((n,r)=>{if(this._state.openComplete)return r(new $.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void r(new $.DatabaseClosed);this.open().catch(N)}this._state.dbReadyPromise.then(n,r)}).then(e)}use({stack:e,create:n,level:r,name:s}){s&&this.unuse({stack:e,name:s});const i=this._middlewares[e]||(this._middlewares[e]=[]);return i.push({stack:e,create:n,level:r??10,name:s}),i.sort((o,a)=>o.level-a.level),this}unuse({stack:e,name:n,create:r}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(s=>r?s.create!==r:!!n&&s.name!==n)),this}open(){return dc(this)}_close(){const e=this._state,n=rn.indexOf(this);if(n>=0&&rn.splice(n,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new C(r=>{e.dbReadyResolve=r}),e.openCanceller=new C((r,s)=>{e.cancelOpen=s})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new $.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,n=this._state;return new C((r,s)=>{const i=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=V(()=>{(function({indexedDB:a,IDBKeyRange:u},c){!ti(a)&&c!==rr&&ei(a,u).delete(c).catch(N)})(this._deps,this.name),r()}),o.onerror=be(s),o.onblocked=this._fireOnBlocked};if(e)throw new $.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(i):i()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return H(this._allTables).map(e=>this._allTables[e])}transaction(){const e=fc.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,n,r){let s=D.trans;s&&s.db===this&&e.indexOf("!")===-1||(s=null);const i=e.indexOf("?")!==-1;let o,a;e=e.replace("!","").replace("?","");try{if(a=n.map(c=>{var h=c instanceof this.Table?c.name:c;if(typeof h!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return h}),e=="r"||e===qs)o=qs;else{if(e!="rw"&&e!=zs)throw new $.InvalidArgument("Invalid transaction mode: "+e);o=zs}if(s){if(s.mode===qs&&o===zs){if(!i)throw new $.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");s=null}s&&a.forEach(c=>{if(s&&s.storeNames.indexOf(c)===-1){if(!i)throw new $.SubTransaction("Table "+c+" not included in parent transaction.");s=null}}),i&&s&&!s.active&&(s=null)}}catch(c){return s?s._promise(null,(h,l)=>{l(c)}):Y(c)}const u=Go.bind(null,this,o,a,s,r);return s?s._promise(o,u,"lock"):D.trans?Et(D.transless,()=>this._whenReady(u)):this._whenReady(u)}table(e){if(!ue(this._allTables,e))throw new $.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const bc=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class _c{constructor(e){this._subscribe=e}subscribe(e,n,r){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:n,complete:r})}[bc](){return this}}function Zo(t,e){return H(e).forEach(n=>{lr(t[n]||(t[n]=new $e),e[n])}),t}function wc(t){let e,n=!1;const r=new _c(s=>{const i=xs(t);let o=!1,a={},u={};const c={get closed(){return o},unsubscribe:()=>{o=!0,Ue.storagemutated.unsubscribe(f)}};s.start&&s.start(c);let h=!1,l=!1;function d(){return H(u).some(p=>a[p]&&gc(a[p],u[p]))}const f=p=>{Zo(a,p),d()&&m()},m=()=>{if(h||o)return;a={};const p={},v=function(g){i&&kt();const y=()=>qe(t,{subscr:g,trans:null}),b=D.trans?Et(D.transless,y):y();return i&&b.then(De,De),b}(p);l||(Ue(un,f),l=!0),h=!0,Promise.resolve(v).then(g=>{n=!0,e=g,h=!1,o||(d()?m():(a={},u=p,s.next&&s.next(g)))},g=>{h=!1,n=!1,s.error&&s.error(g),c.unsubscribe()})};return m(),c});return r.hasValue=()=>n,r.getValue=()=>e,r}let ai;try{ai={indexedDB:z.indexedDB||z.mozIndexedDB||z.webkitIndexedDB||z.msIndexedDB,IDBKeyRange:z.IDBKeyRange||z.webkitIDBKeyRange}}catch{ai={indexedDB:null,IDBKeyRange:null}}const ot=it;function hr(t){let e=Ie;try{Ie=!0,Ue.storagemutated.fire(t)}finally{Ie=e}}vt(ot,{...Vn,delete:t=>new ot(t,{addons:[]}).delete(),exists:t=>new ot(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:n}){return ti(e)?Promise.resolve(e.databases()).then(r=>r.map(s=>s.name).filter(s=>s!==rr)):ei(e,n).toCollection().primaryKeys()}(ot.dependencies).then(t)}catch{return Y(new $.MissingAPI)}},defineClass:()=>function(t){ne(this,t)},ignoreTransaction:t=>D.trans?Et(D.transless,t):t(),vip:ni,async:function(t){return function(){try{var e=ri(t.apply(this,arguments));return e&&typeof e.then=="function"?e:C.resolve(e)}catch(n){return Y(n)}}},spawn:function(t,e,n){try{var r=ri(t.apply(n,e||[]));return r&&typeof r.then=="function"?r:C.resolve(r)}catch(s){return Y(s)}},currentTransaction:{get:()=>D.trans||null},waitFor:function(t,e){const n=C.resolve(typeof t=="function"?ot.ignoreTransaction(t):t).timeout(e||6e4);return D.trans?D.trans.waitFor(n):n},Promise:C,debug:{get:()=>ve,set:t=>{vo(t,t==="dexie"?()=>!0:Mo)}},derive:bt,extend:ne,props:vt,override:ho,Events:sn,on:Ue,liveQuery:wc,extendObservabilitySet:Zo,getByKeyPath:Ke,setByKeyPath:fe,delByKeyPath:function(t,e){typeof e=="string"?fe(t,e,void 0):"length"in e&&[].map.call(e,function(n){fe(t,n,void 0)})},shallowClone:yo,deepClone:Gt,getObjectDiff:si,cmp:re,asap:fo,minKey:Ns,addons:[],connections:rn,errnames:Ps,dependencies:ai,semVer:To,version:To.split(".").map(t=>parseInt(t)).reduce((t,e,n)=>t+e/Math.pow(10,2*n))}),ot.maxKey=cn(ot.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Ue(un,t=>{if(!Ie){let e;nr?(e=document.createEvent("CustomEvent"),e.initCustomEvent(Ve,!0,!0,t)):e=new CustomEvent(Ve,{detail:t}),Ie=!0,dispatchEvent(e),Ie=!1}}),addEventListener(Ve,({detail:t})=>{Ie||hr(t)}));let Ie=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(Ve);typeof t.unref=="function"&&t.unref(),Ue(un,e=>{Ie||t.postMessage(e)}),t.onmessage=e=>{e.data&&hr(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Ue(un,e=>{try{Ie||(typeof localStorage<"u"&&localStorage.setItem(Ve,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(n=>n.postMessage({type:Ve,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===Ve){const n=JSON.parse(e.newValue);n&&hr(n.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===Ve&&hr(e.changedParts)})}C.rejectionMapper=function(t,e){if(!t||t instanceof wt||t instanceof TypeError||t instanceof SyntaxError||!t.name||!xo[t.name])return t;var n=new xo[t.name](e||t.message,t);return"stack"in t&&Ce(n,"stack",{get:function(){return this.inner.stack}}),n},vo(ve,Mo);const xc=!1,kc=500,Ec=500;let pe=[],ui=0,dr=null,ea=()=>{};const Pc=new Promise(t=>{ea=t}),ta=new te({tokenize:"forward"});let at=null;const dn=new au({distanceFunction:"cosine-normalized",seed:123,useIndexedDB:!0,efConstruction:40});self.onmessage=t=>{switch(t.data.command){case"startLoadData":{console.log("Worker: start streaming data"),so("Stream data",!0);const{url:e,indexURL:n}=t.data.payload;Sc(e,n).then(()=>{},()=>{});break}case"startLexicalSearch":{const{query:e,limit:n,requestID:r}=t.data.payload;Oc(e,n,r).then(()=>{},()=>{});break}case"startExportIndex":{const n={command:"finishExportIndex",payload:{indexJSON:dn.exportIndex()}};postMessage(n);break}case"startSemanticSearch":{const{requestID:e,embedding:n,topK:r,efSearch:s,maxDistance:i}=t.data.payload;Dc(n,r,i,s,e).then(()=>{},()=>{});break}default:{console.error("Worker: unknown message",t.data.command);break}}};const Sc=async(t,e)=>{const n=new it("mememo-document-store");n.version(1).stores({mememo:"id"});const r=n.table("mememo");at=r.clear().then(()=>r);let s=!1;if(e!==void 0)try{console.time("Load index");const i=new DecompressionStream("gzip"),u=(await(await fetch(e)).blob()).stream().pipeThrough(i),c=await new Response(u).blob(),h=JSON.parse(await c.text());dn.loadIndex(h),console.timeEnd("Load index"),s=!0}catch(i){console.error(i)}fetch(t).then(async i=>{var a,u,c,h,l;if(!i.ok){console.error("Failed to load data",i);return}const o=(l=(h=(c=(u=(a=i.body)==null?void 0:a.pipeThrough(new DecompressionStream("gzip")))==null?void 0:u.pipeThrough(new TextDecoderStream))==null?void 0:c.pipeThrough(uu(`
`)))==null?void 0:h.pipeThrough(cu()))==null?void 0:l.getReader();for(;o!==void 0;){const d=await o.read(),f=d.value;if(d.done){so("Stream data",xc),Kc();break}else await Cc(f,s)}},()=>{})},Cc=async(t,e)=>{if(at===null)throw Error("documentDB is null");const n=await at,r={id:String(t[0]),text:t[1],embedding:t[2]},s=e?Ec:kc;if(pe.push(r),ta.add(r.id,r.text),ui+=1,pe.length>=s){const i=pe.map(c=>c.id),o=pe.map(c=>c.embedding),a=pe.map(c=>({id:c.id,text:c.text}));await n.bulkPut(a),e?await dn.bulkInsertSkipIndex(i,o):await dn.bulkInsert(i,o);const u={command:"transferLoadData",payload:{isFirstBatch:dr===null,isLastBatch:!1,documents:pe.map(c=>c.text),loadedPointCount:ui}};postMessage(u),dr=pe.slice(),pe=[]}},Kc=()=>{const t={command:"transferLoadData",payload:{isFirstBatch:dr===null,isLastBatch:!0,documents:pe.map(e=>e.text),loadedPointCount:ui}};postMessage(t),dr=pe.slice(),pe=[],ea()},Oc=async(t,e,n)=>{if(at===null)throw Error("documentDB is null");const r=await at,s=await ta.search(t,{limit:e}),i=await r.bulkGet(s),o=[];for(const u of i)u!==void 0&&o.push(u.text);postMessage({command:"finishLexicalSearch",payload:{query:t,results:o,requestID:n}})},Dc=async(t,e,n,r,s)=>{if(at===null)throw Error("documentDB is null");const i=await at;await Pc;const{keys:o,distances:a}=await dn.query(t,e,r),u=await i.bulkGet(o),c=[],h=[];for(const[d,f]of u.entries())f!==void 0&&a[d]<=n&&(c.push(f.text),h.push(a[d]));postMessage({command:"finishSemanticSearch",payload:{embedding:t,topK:e,requestID:s,maxDistance:n,efSearch:r,documents:c,documentDistances:h}})}})();
